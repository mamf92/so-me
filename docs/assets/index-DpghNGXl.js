(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const $="/so-me/";class se{routes;outlet;onRouteChange;constructor(t,n,o){this.routes=t,this.outlet=n,this.onRouteChange=o,window.addEventListener("popstate",()=>this.resolveRoute())}navigate(t){const n=t.startsWith($)?t:$+t.replace(/^\/+/,"");history.pushState({},"",n),this.resolveRoute()}resolveRoute(){const t=window.location.pathname,n=t.startsWith($)?t.slice($.length-1)||"/":t;this.onRouteChange?.(n);const o=this.routes[n]||this.notFoundView;try{const r=o();r instanceof Promise?r.then(a=>this.render(a)).catch(()=>this.render(this.errorView("Failed to load page."))):this.render(r)}catch{this.render(this.errorView("Unexpected error."))}}render(t){typeof t=="string"?this.outlet.innerHTML=t:t instanceof HTMLElement?(this.outlet.innerHTML="",this.outlet.appendChild(t)):this.outlet.innerHTML=""}notFoundView(){return`
      <div class="text-center py-10">
        <h1 class="text-4xl font-bold color-darkgrey mb-4 font-heading">404</h1>
        <p class="text-xl color-grey font-heading">Page not found or under development</p>
        <a href="${$}" class="mt-6 inline-block text-blue-600 hover:underline font-body">
          Return to home page
        </a>
      </div>
    `}errorView(t){return`
      <div class="text-center py-10">
        <h1 class="text-2xl font-heading text-red-600 mb-4">Error</h1>
        <p class="font-body">${t}</p>
      </div>
    `}}const le={PasswordTitle:"Password must be at least 8 characters long",EmailTitle:"Email must be a @stud.noroff.no address"};function y({id:e,name:t,label:n,type:o,placeholder:r,value:a,required:s,title:l,pattern:c,minLength:m,maxLength:d}){const i=document.createElement("div");i.className="flex flex-col w-full justify-start gap-2";const f=document.createElement("label");f.htmlFor=e,f.textContent=n,f.className="font-heading text-md font-bold";const p=document.createElement("input");return p.id=e,p.name=t,p.type=o??"",p.placeholder=r??"",p.value=a??"",p.required=s??!1,p.pattern=c??"",p.minLength=m??0,p.maxLength=d??524288,p.title=l?le[l]??l:"",p.className="flex flex-row p-2 bg-white rounded-lg outline-[0.1875rem] outline-black justify-start items-center font-body text-sm",i.appendChild(f),i.appendChild(p),i}const ie={xsmall:"text-xs rounded-md md:text-sm p-1 border-none md:border-none lg:border-none",small:"text-sm md:text-md p-2",medium:"text-md md:text-lg p-3",large:"text-lg md:text-xl p-4"},ce="inline-block font-extrabold rounded-2xl border-6 md:border-8 border-black";function G(e="medium",t=!1){return`${ce} ${t?"bg-black text-white hover:bg-white hover:text-black":"bg-white text-black hover:bg-black hover:text-white"} ${ie[e]}`}function w({label:e,size:t="medium",id:n,fill:o=!1,onClick:r}){const a=document.createElement("button");return a.className=G(t,o),n&&(a.id=n),a.textContent=e,r&&a.addEventListener("click",r),a}function L({label:e,size:t="medium",id:n,fill:o=!1,href:r}){const a=document.createElement("a");return a.className=G(t,o),n&&(a.id=n),a.textContent=e,a.href=r,a}const de="https://v2.api.noroff.dev";async function B(e,t={}){const{body:n,...o}=t,r={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`,"X-Noroff-API-Key":"2b5f7ac6-af0f-4649-a046-1152e518bdb0"},a={method:n?"POST":"GET",...o,headers:{...r,...o.headers}};n&&(a.body=JSON.stringify(n));try{const s=await fetch(de+e,a);if(!s.ok){const l=await s.json();throw new Error(l.errors?.[0]?.message||"An API error occurred")}return s.status===204?null:await s.json()}catch(s){throw console.error("API Client Error:",s),s}}const v=e=>B(e),R=(e,t)=>B(e,{body:t}),D=(e,t)=>B(e,{method:"PUT",body:t}),me=e=>B(e,{method:"DELETE"}),K={error:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.2" stroke="currentColor" class="h-[9.25rem] w-[9.25rem]"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" /> </svg>',warning:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.2" stroke="currentColor" class="h-[9.25rem] w-[9.25rem]"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" /> </svg>',success:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.2" stroke="currentColor" class="h-[9.25rem] w-[9.25rem]"> <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /> </svg>'};function u({title:e,message:t,icon:n}){const o=document.createElement("div");o.className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 border-8 lg:border-16 border-black rounded-2xl z-[1000] flex flex-col items-center justify-center w-[95vw] max-w-[35rem] md:min-w-[21rem] bg-white px-2 lg:px-6 pt-6 pb-2 gap-4";const r=document.createElement("div");r.className="flex flex-row items-center w-full max-h-[9.375rem]";const a=document.createElement("div");a.className="flex flex-col w-[calc(100%-9.25rem)] text-black gap-2 p-4";const s=document.createElement("h2");s.className="font-heading text-3xl lg:text-4xl font-extrabold",s.textContent=e;const l=document.createElement("p");l.className="font-body text-lg",l.textContent=t;const c=document.createElement("div");c.className="flex justify-center h-[9.25rem]";const m=document.createElement("svg");m.innerHTML=K[n];const d=document.createElement("div");d.className="flex flex-row width-full justify-center gap-2 p-2 md:gap-0";const i=w({label:"Close",size:"medium",onClick:()=>o.remove()});return o.appendChild(r),r.appendChild(a),a.appendChild(s),a.appendChild(l),r.appendChild(c),c.appendChild(m),o.appendChild(d),d.appendChild(i),document.body.appendChild(o),o.classList.add("show"),o}function I({title:e,message:t,icon:n,confirmationLabel:o="Confirm",cancellationLabel:r="Cancel"}){return new Promise(a=>{const s=document.createElement("div");s.className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 outline-16 outline-black rounded-lg z-[1000] flex flex-col items-center justify-center w-[60vw] md:min-w-[21rem] bg-white p-8 gap-6";const l=document.createElement("div");l.className="flex flex-row items-center w-full max-h-[9.375rem]";const c=document.createElement("div");c.className="flex flex-col w-[calc(100%-9.25rem)] text-black gap-0.5 p-4";const m=document.createElement("h3");m.className="font-heading text-4xl font-extrabold",m.textContent=e;const d=document.createElement("p");d.className="font-body text-lg",d.textContent=t;const i=document.createElement("div");i.className="flex justify-center h-[9.25rem]";const f=document.createElement("svg");f.innerHTML=K[n];const p=document.createElement("div");p.className="flex flex-row width-full justify-center gap-8 p-6";const g=w({label:r,size:"small",onClick:()=>{s.remove(),a(!1)}}),b=w({label:o,size:"small",fill:!0,onClick:()=>{s.remove(),a(!0)}});s.appendChild(l),l.appendChild(c),c.appendChild(m),c.appendChild(d),l.appendChild(i),i.appendChild(f),s.appendChild(p),p.appendChild(g),p.appendChild(b),document.body.appendChild(s),s.classList.add("show")})}async function fe(e){if(!ge(e))throw new Error("Validation failed");const t=await R("/auth/register",e);if(!t)throw new Error("Error registering user: No response data received.");return t}async function ue(e){if(!pe(e))throw new Error("Validation failed");try{const t=await R("/auth/login",e);if(!t)throw new Error("Error signing in: No response data received.");return localStorage.setItem("accessToken",t.data.accessToken),localStorage.setItem("userName",t.data.name),t}catch(t){throw console.error(t),t}}function pe(e){if(!e)return u({title:"No data provided.",message:"Please check all fields, and try again.",icon:"error"}),!1;if(!e.email||!e.password)return u({title:"All fields are required.",message:"Please check all fields, and try again.",icon:"error"}),!1;const t=/^[a-zA-Z0-9._%+\-]+@stud\.noroff\.no$/,n=/^[a-zA-Z0-9._%+\-]{8,}$/;return t.test(e.email)?n.test(e.password)?!0:(u({title:"Invalid password.",message:"Password must be at least 8 characters long and can only contain letters, numbers, and special characters.",icon:"error"}),!1):(u({title:"Invalid email format.",message:"Email must be a valid email address ending with @stud.noroff.no",icon:"error"}),!1)}function ge(e){if(!e)return u({title:"No data provided.",message:"Please check all fields, and try again.",icon:"error"}),!1;if(!e.name||!e.email||!e.password)return u({title:"All fields are required.",message:"Please check all fields, and try again.",icon:"error"}),!1;const t=/^[a-zA-ZÀ-ÿ_]{3,}$/,n=/^[a-zA-Z0-9._%+\-]+@stud\.noroff\.no$/,o=/^[a-zA-ZÀ-ÿ0-9#?!@$%^&*\-]{8,}$/;return t.test(e.name)?n.test(e.email)?o.test(e.password)?!0:(u({title:"Invalid password.",message:"Password must be at least 8 characters long and can only contain letters, numbers, and special characters.",icon:"error"}),!1):(u({title:"Invalid email format.",message:"Email must be a valid email address ending with @stud.noroff.no",icon:"error"}),!1):(u({title:"Invalid name format.",message:"Name must be at least 3 characters long and can only contain letters, spaces, and hyphens.",icon:"error"}),!1)}function A(){return!!localStorage.getItem("accessToken")}const J="/so-me/";async function he(e){e.preventDefault();const t=e.target,n=new FormData(t),o=n.get("email"),r=n.get("password");try{const a=await ue({email:o,password:r});a&&a.data&&a.data.accessToken&&(window.location.href=J)}catch(a){const s=a?.message+". Please check your email and password, and try again."||"Please check your email and password, and try again.";u({title:"Login failed.",message:s,icon:"error"})}}function we(){const e=document.createElement("div");e.className="flex flex-col w-[90vw] bg-white p-4 py-5 lg:px-8 lg:py-6 rounded-3xl border-8 lg:border-16 border-black lg:max-w-[42.5rem] gap-8";const t=document.createElement("h1");t.innerText="Login",t.className="text-4xl lg:text-6xl font-extrabold self-center";const n=document.createElement("p");n.innerHTML=`Do you have an account? Register <a href="${J}register" class="underline">here</a>.`,n.className="text-lg font-body self-center";const o=document.createElement("form");o.id="login-form",o.className="flex flex-col gap-8 w-full items-center",o.addEventListener("submit",he);const r=y({id:"email",name:"email",label:"Email",type:"email",placeholder:"Enter your @stud.noroff.no email",pattern:"^[a-zA-Z0-9._%+\\-]+@stud\\.noroff\\.no$",required:!0,title:"EmailTitle"});r.classList.add("w-full");const a=y({id:"password",name:"password",label:"Password",type:"password",pattern:"^.{8,}$",placeholder:"Enter your password",required:!0,title:"PasswordTitle"});a.classList.add("w-full");const s=w({label:"Login",size:"medium"});return o.appendChild(r),o.appendChild(a),o.appendChild(s),e.appendChild(t),e.appendChild(n),e.appendChild(o),e}function xe(){const e=document.createElement("div");return e.className="flex flex-col items-center justify-center w-full",e.appendChild(we()),e}const Q="/so-me/";async function ye(e){e.preventDefault();const t=e.target,n=new FormData(t),r=n.get("name").trim().replace(/\s+/g,"_"),a=n.get("email"),s=n.get("password");try{const l=await fe({name:r,email:a,password:s});l&&l.data&&(u({title:"Registration successful!",message:"You can now log in with your new account.",icon:"success"}),setTimeout(()=>{window.location.href=Q+"login"},2e3))}catch(l){const c=l?.message||"An unknown error occurred.";u({title:"Registration Error",message:c,icon:"error"})}}function be(){const e=document.createElement("div");e.className="flex flex-col w-[90vw] bg-white px-4 py-5 lg:px-8 lg:py-6 rounded-3xl border-8 lg:border-16 border-black gap-8 lg:max-w-[42.5rem]";const t=document.createElement("h1");t.innerText="Register account",t.className="text-4xl lg:text-6xl font-extrabold self-center";const n=document.createElement("p");n.innerHTML=`Already have an account? Login <a href="${Q}login" class="underline">here</a>.`,n.className="text-lg font-body self-center";const o=document.createElement("form");o.id="register-form",o.className="flex flex-col gap-8 w-full items-center",o.addEventListener("submit",ye);const r=y({id:"name",name:"name",label:"Name",type:"text",placeholder:"Enter your name",pattern:"^[a-zA-ZÀ-ÿs-]{3,}+$",required:!0,title:"Enter your full name. Letters, spaces, and hyphens only."});r.classList.add("w-full");const a=y({id:"email",name:"email",label:"Email",type:"email",placeholder:"Enter your @stud.noroff.no email",pattern:"^[a-zA-Z0-9._%+\\-]+@stud\\.noroff\\.no$",required:!0,title:"EmailTitle"});a.classList.add("w-full");const s=y({id:"password",name:"password",label:"Password",type:"password",placeholder:"Enter your password",pattern:"^.{8,}$",required:!0,title:"PasswordTitle"});s.classList.add("w-full");const l=w({label:"Register",size:"medium"});return o.appendChild(r),o.appendChild(a),o.appendChild(s),o.appendChild(l),e.appendChild(t),e.appendChild(n),e.appendChild(o),e}function Ce(){const e=document.createElement("div");return e.className="flex flex-col items-center justify-center w-full",e.appendChild(be()),e}async function U({page:e=1,limit:t=10}){try{const n=await v(`/social/posts?page=${e}&limit=${t}&_author=true`);if(!n)throw new Error("Could not get posts.");return n}catch(n){throw console.error("Error fetching posts:",n),n}}async function ee(e){try{const t=await v(`/social/posts/${e}?_author=true`);if(!t)throw new Error("Could not get post.");return t}catch(t){throw console.error("Error fetching post:",t),t}}async function q({page:e=1,limit:t=10}){try{const n=await v(`/social/posts/following?page=${e}&limit=${t}&_author=true`);if(!n)throw new Error("Error fetching posts from followed users.");return n}catch(n){throw console.error("Error fetching posts from followed users:",n),n}}async function Ee(e){try{const t=await v(`/social/posts/search?q=${e}&_author=true`);if(!t)throw new Error("Error fetching search results.");return t}catch(t){throw console.error("Error fetching search results:",t),t}}async function ve(e){if(!Le(e))throw new Error("Validation failed");try{const t=await R("/social/posts",e);if(!t)throw new Error("Error creating post: No response data received.");return t}catch(t){throw console.error("Error creating post:",t),t}}async function Ne(e,t){try{const n=await D(`/social/posts/${e}`,t);if(!n)throw new Error("Error updating post: No response data received.");return n}catch(n){throw console.error("Error updating post:",n),n}}async function Pe(e){try{await me(`/social/posts/${e}`),u({title:"Post deleted",message:"The post has been successfully deleted.",icon:"success"})}catch(t){throw t instanceof Error&&u({title:"Error deleting post.",message:t.message,icon:"error"}),t}}function Le(e){if(!e)return u({title:"No data provided.",message:"Please check all fields, and try again.",icon:"error"}),!1;if(!e.title||!e.body)return u({title:"Missing required fields.",message:"Title and body are required.",icon:"error"}),!1;const t=/^.{3,60}$/,n=/^.{3,}$/,o=/^[a-zA-ZÀ-ÿ0-9]{3,}$/,r=/^.*\.(gif|jpe?g|png|webp)($|\?.*$|#.*$|\/.*$)$/,a=/^.{3,150}$/;if(!t.test(e.title))return u({title:"Invalid title format.",message:"Min 3 chars. Letters, numbers and special characters #?!@$%^&*- are allowed.",icon:"warning"}),!1;if(!n.test(e.body))return u({title:"Invalid body format.",message:"Min 3 chars. Letters, numbers and special characters #?!@$%^&*- are allowed.",icon:"warning"}),!1;if(e.tags){for(const s of e.tags)if(!o.test(s))return u({title:"Invalid tag format.",message:"Each tag must be at least 3 characters long and can only contain letters and numbers.",icon:"warning"}),!1}if(e.media){if(!r.test(e.media.url))return u({title:"Invalid image URL format.",message:"Image URL must be a valid image file (gif, jpeg, png, webp).",icon:"warning"}),!1;if(!a.test(e.media.alt))return u({title:"Invalid image alt text format.",message:"Alt text must be 150 characters or less.",icon:"warning"}),!1}return!0}async function H(e){try{const t=await v(`/social/profiles/${e}`);if(!t)throw new Error("Could not fetch profile by name.");return t}catch(t){throw console.error("Error fetching profile by name:",t),t}}async function _(e){try{const t=await v(`/social/profiles/${e.name}/posts?page=${e.page||1}&limit=${e.limit||10}&_author=true`);if(!t)throw new Error("Could not fetch posts by profile.");return t}catch(t){throw console.error("Error fetching posts by profile:",t),t}}async function ke(e){console.log(`Calling followProfile for: ${e}`);try{const t=await D(`/social/profiles/${e}/follow`);if(!t)throw new Error("Could not follow profile.");return t}catch(t){throw console.error("Error following profile:",t),t}}async function Te(e){try{const t=await D(`/social/profiles/${e}/unfollow`);if(!t)throw new Error("Could not unfollow profile.");return t}catch(t){throw console.error("Error fetching posts by profile:",t),t}}async function Z(e){try{const t=await v(`/social/profiles/${e}?_following=true`);if(!t||!t.data)throw new Error("Could not fetch following names.");const n=t.data.following?.map(o=>o.name)||[];return new Set(n)}catch(t){throw console.error("Error fetching following names:",t),t}}const $e="/so-me/";function M(e,t){if(!e)return console.error("No post data provided to renderPostCard."),document.createElement("div");const n=document.createElement("article");n.className="post-card flex flex-col w-[calc(100%-2rem)] max-w-[42.5rem] justify-center items-center lg:flex-row w-full lg:max-h-[10rem] rounded-2xl border-8 border-black overflow-hidden";const o=document.createElement("div");if(o.className="flex lg:h-40 lg:w-[calc(20%-1rem)] shrink-0 overflow-hidden",e.media){const h=document.createElement("img");h.src=e.media.url,h.alt=e.media.alt||e.title,h.className="lg:h-full lg:w-full object-cover hover:cursor-pointer",o.appendChild(h)}n.appendChild(o);const r=document.createElement("div");r.className="flex flex-col w-full gap-2 px-2 py-1 justify-center";const a=document.createElement("div");a.className="flex flex-row w-full justify-between";const s=document.createElement("div");s.className="flex flex-row gap-2 items-center";const l=document.createElement("span");if(l.className="font-body text-xs hover:underline hover:cursor-pointer",l.textContent=e.author?.name||"Unknown Profile",l.addEventListener("click",h=>{h.stopPropagation(),window.location.href=$e+`profile?name=${e.author?.name}`}),s.appendChild(l),t!==void 0){let h=t;const N=w({label:h?"Unfollow":"Follow",size:"xsmall",onClick:async j=>{j.stopPropagation();const k=e.author?.name;if(!k){console.error("Author name is undefined. Cannot follow/unfollow.");return}const x=j.currentTarget;x.disabled=!0;const T=x.textContent;x.textContent=h?"Unfollowing...":"Following...";try{h?await Te(k):await ke(k),h=!h,x.textContent=h?"Unfollow":"Follow"}catch(ae){console.error("Follow toggle failed:",ae),x.textContent=T||(h?"Unfollow":"Follow")}finally{x.disabled=!1}window.location.reload()}});s.appendChild(N)}a.appendChild(s);const c=document.createElement("div");c.className="flex flex-row gap-2 items-center";const m=document.createElement("span");m.innerHTML=`
    <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2.2' stroke='currentColor' class='h-4 w-4 text-black'>
      <path stroke-linecap='round' stroke-linejoin='round' d='M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z' />
    </svg>
  `,c.appendChild(m);const d=document.createElement("span");d.className="font-body text-xs",d.textContent=new Date(e.updated).toLocaleDateString([],{weekday:"short",year:"numeric",month:"short",day:"2-digit"}),c.appendChild(d);const i=document.createElement("span");i.className="font-body text-xs",i.textContent=new Date(e.updated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),c.appendChild(i),a.appendChild(c),r.appendChild(a);const f=document.createElement("h3");f.className="font-heading font-extrabold text-sm text-left hover:cursor-pointer",f.textContent=e.title,r.appendChild(f);const p=document.createElement("p");p.className="font-body text-xs hover:cursor-pointer",p.textContent=e.body,r.appendChild(p);const g=document.createElement("div");g.className="flex flex-row gap-4 items-center";const b=document.createElement("div");return b.className="flex flex-row text-sm text-black underline gap-2",Array.isArray(e.tags)&&e.tags.forEach(h=>{const N=document.createElement("span");N.textContent=`#${h}`,b.appendChild(N)}),g.appendChild(b),r.appendChild(g),n.appendChild(r),n}const S="/so-me/";function te({posts:e,currentPage:t,followingNames:n,initialPage:o=1,limit:r=10}){const a=document.createElement("section");a.innerHTML="",a.className="flex flex-col w-full gap-4 justify-center items-center max-w-[calc(100%-2rem)] lg:max-w-[42.5rem]";const s=document.createElement("div");if(s.className="flex flex-row justify-between items-center w-full",s.appendChild(w({label:"Newest",size:"medium",fill:t==="newest",onClick:()=>{window.location.href=S}})),s.appendChild(w({label:"Following",size:"medium",fill:t==="following",onClick:()=>{window.location.href=S+"followingfeed"}})),s.appendChild(w({label:"Create",size:"medium",fill:!1,onClick:()=>{window.location.href=S+"create"}})),a.appendChild(s),e.length===0&&t==="following"){I({title:"No post from followed users.",message:"Go explore and follow some users!",icon:"warning",confirmationLabel:"Explore",cancellationLabel:"Later"}).then(g=>{g&&(window.location.href=S+"explore")});const f=document.createElement("img"),p=new URL("/so-me/assets/mac-looking-BAD6zzoX.gif",import.meta.url).href;return f.src=p,f.alt="No posts",f.className="w-auto h-48 mb-4",a.appendChild(f),a}const l=n||new Set,c=document.createElement("div");c.className="flex flex-col w-full gap-4",a.appendChild(c);function m(f){f.forEach(p=>{const g=p.author?.name||"",b=g!==""&&l.has(g),h=M(p,b);h.addEventListener("click",()=>{window.location.href=S+`post?id=${p.id}`}),c.appendChild(h)})}m(e);let d=o,i=!1;if(e.length===r){const f=w({label:"Load more",size:"medium",fill:!1,onClick:async()=>{if(!i){i=!0,f.disabled=!0,f.textContent="Loading...";try{const p=d+1,g=t==="following"?await q({page:p,limit:r}):await U({page:p,limit:r});g&&g.data&&g.data.length>0?(m(g.data),d=p,g.data.length<r?f.remove():(f.textContent="Load more",f.disabled=!1)):f.remove()}catch{f.textContent="Load more",f.disabled=!1}finally{i=!1}}}});f.classList.add("mt-2","w-full"),a.appendChild(f)}return a}function C(e){const t=document.createElement("div");return t.className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center justify-center bg-white rounded-3xl bg-opacity-75 z-50",t.id="loader-container",t.innerHTML='<div id="loader" class="loader"></div>',document.body.appendChild(t),t}function E(){const e=document.getElementById("loader");e?(e.classList.remove("loader"),e.parentElement?.remove()):console.warn("No spinner found to hide.")}const Se="/so-me/";async function Ie({page:e=1,limit:t=10}){try{return await U({page:e,limit:t})}catch(n){n instanceof Error&&u({title:"Error fetching posts for feed.",message:n.message,icon:"error"})}}async function Ae(){if(!A()){u({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href=Se+"login"},3e3);return}const t=document.createElement("div");t.className="flex flex-col items-center justify-center gap-8 mb-[10rem]",C();try{const[n,o]=await Promise.all([Ie({page:1,limit:10}),Z(localStorage.getItem("userName")||"")]);if(n&&n.data){const r=te({posts:n.data,currentPage:"newest",followingNames:o||new Set});t.appendChild(r)}}catch(n){n instanceof Error&&u({title:"Error rendering home page.",message:n.message,icon:"error"})}return E(),t}const je="/so-me/";function ne(e){if(!e)return console.error("No profile data provided to renderProfileCard."),document.createElement("div");const t=document.createElement("article");if(t.className="profile-card flex flex-col w-[calc(100%-2rem)] sm:max-w-[42.5rem] justify-center items-center sm:flex-row lg:max-h-[8rem] rounded-2xl border-8 border-black overflow-hidden hover:cursor-pointer",t.addEventListener("click",()=>{window.location.href=je+`profile?name=${e.name}`}),e.avatar){const d=document.createElement("div");d.className="flex justify-center sm:max-w-[calc(20%-1rem)] shrink-0 lg:h-40 lg:w-[calc(20%-1rem)]",t.appendChild(d);const i=document.createElement("img");i.src=e.avatar.url,i.alt=e.avatar.alt,i.className="lg:h-full lg:w-full object-cover",d.appendChild(i)}const n=document.createElement("div");n.className="flex flex-col w-full gap-2 px-2 py-1 justify-center";const o=document.createElement("div");o.className="flex flex-col lg:flex-row w-full justify-between";const r=document.createElement("div");r.className="flex flex-row gap-2 items-center";const a=document.createElement("span");a.className="font-heading text-md font-extrabold",a.textContent=e.name,r.appendChild(a),o.appendChild(r);const s=document.createElement("div");s.className="flex flex-row gap-2 items-center";const l=document.createElement("span");l.className="font-body text-xs",l.textContent=`Followers: ${e._count.followers}`,s.appendChild(l);const c=document.createElement("span");c.className="font-body text-xs",c.textContent=`Following: ${e._count.following}`,s.appendChild(c),o.appendChild(s),n.appendChild(o);const m=document.createElement("p");return m.className="font-body text-xs",m.textContent=e.bio,n.appendChild(m),t.appendChild(n),t}async function Fe(e,t){e.preventDefault();const n=e.target,r=new FormData(n).get("search");t(r)}function Be(e){const t=document.createElement("div");t.className="flex flex-col w-[90vw] bg-white p-4 py-5 lg:px-8 lg:py-6 rounded-3xl border-8 lg:border-16 border-black lg:max-w-[42.5rem] gap-8";const n=document.createElement("h1");n.innerText="Search",n.className="text-md lg:text-6xl font-extrabold self-center";const o=document.createElement("p");o.innerHTML="Search for keywords in posts.",o.className="text-xs font-body self-center";const r=document.createElement("form");r.id="search-form",r.className="flex flex-col gap-8 w-full items-center",r.addEventListener("submit",l=>Fe(l,e));const a=y({id:"search",name:"search",label:"Search",type:"text",placeholder:"Enter one search keyword",pattern:"\\S{1,30}",required:!0,title:"Only one keyword, max 30 characters"}),s=w({label:"Search",size:"medium"});return r.appendChild(a),r.appendChild(s),t.appendChild(n),t.appendChild(o),t.appendChild(r),t}const O="/so-me/";async function Me({page:e=1,limit:t=30}={}){const n=await U({page:e,limit:t});if(!n||!n.data)return[];const o=new Set,r=[];for(const a of n.data){const s=a.author?.name;s&&!o.has(s)&&(o.add(s),r.push(s))}return r}async function ze(e){const t=await Promise.allSettled(e.map(o=>H(o))),n=[];for(const o of t)o.status==="fulfilled"&&o.value?.data&&n.push(o.value.data);return n}async function Re(){if(!A()){u({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href=O+"login"},3e3);return}const t=document.createElement("div");t.className="flex flex-col items-center justify-center mb-[10rem]";const n=document.createElement("div");n.className="flex flex-col items-center justify-center w-full mb-8";const o=document.createElement("div");o.className="flex flex-col items-center justify-center w-full gap-6";function r(s){s.trim()&&(C(),Ee(s).then(l=>{if(o.innerHTML="",!l||!l.data||l.data.length===0){u({title:"No posts found",message:"No posts matched your search query.",icon:"warning"});return}for(const c of l.data){const m=M(c);m.addEventListener("click",()=>{window.location.href=O+`post?id=${c.id}`}),o.appendChild(m)}}).catch(l=>{console.error("Error searching posts:",l),l instanceof Error&&u({title:"Error searching posts",message:l.message,icon:"error"})}).finally(()=>E()))}const a=Be(r);n.appendChild(a),t.appendChild(n),t.appendChild(o),C();try{const s=await Me({page:1,limit:30});if(s.length===0)throw new Error("No authors found from posts.");const l=await ze(s);if(l.length===0)throw new Error("No profiles found for the authors.");for(const c of l)o.appendChild(ne(c))}catch(s){s instanceof Error&&u({title:"Error rendering explore page",message:s.message,icon:"error"})}finally{E()}return t}function De(e){if(!e)return console.error("No profile data provided to renderMyProfileCard."),document.createElement("div");const t=document.createElement("article");if(t.className="profile-card flex flex-col w-[calc(100%-2rem)] sm:max-w-[42.5rem] justify-center items-center sm:flex-row lg:max-h-[8rem] rounded-2xl border-8 border-black overflow-hidden",e.avatar){const d=document.createElement("div");d.className="flex justify-center sm:max-w-[calc(20%-1rem)] shrink-0 lg:h-40 lg:w-[calc(20%-1rem)]",t.appendChild(d);const i=document.createElement("img");i.src=e.avatar.url,i.alt=e.avatar.alt,i.className="lg:h-full lg:w-full object-cover",d.appendChild(i)}const n=document.createElement("div");n.className="flex flex-col w-full gap-2 px-2 py-1 justify-center";const o=document.createElement("div");o.className="flex flex-col lg:flex-row w-full justify-between";const r=document.createElement("div");r.className="flex flex-row gap-2 items-center";const a=document.createElement("span");a.className="font-heading text-md font-extrabold",a.textContent=e.name,r.appendChild(a),o.appendChild(r);const s=document.createElement("div");s.className="flex flex-row gap-2 items-center";const l=document.createElement("span");l.className="font-body text-xs",l.textContent=`Followers: ${e._count.followers}`,s.appendChild(l);const c=document.createElement("span");c.className="font-body text-xs",c.textContent=`Following: ${e._count.following}`,s.appendChild(c),o.appendChild(s),n.appendChild(o);const m=document.createElement("p");return m.className="font-body text-xs",m.textContent=e.bio,n.appendChild(m),t.appendChild(n),t}const W="/so-me/";function Ue(e){if(!e)return document.createElement("div");const t=document.createElement("article");t.className="post-card flex flex-col w-[calc(100vw-2rem)] max-w-[42.5rem] gap-2";const n=document.createElement("div");n.className="flex flex-col sm:items-center sm:flex-row rounded-2xl overflow-hidden border-8 border-black";const o=document.createElement("div");if(o.className="flex justify-center sm:max-w-[calc(20%-1rem)] shrink-0",e.media){const x=document.createElement("img");x.src=e.media.url,x.alt=e.media.alt||"",x.className="flex h-full object-cover",o.appendChild(x)}n.appendChild(o);const r=document.createElement("div");r.className="flex flex-col w-full gap-2 px-2 py-1 justify-center";const a=document.createElement("div");a.className="flex flex-row w-full justify-between";const s=document.createElement("span");s.className="font-body text-xs",s.textContent=e.author?.name||"Unknown Profile",a.appendChild(s);const l=document.createElement("div");l.className="flex flex-row gap-2 items-center";const c=document.createElement("span");c.innerHTML=`
    <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2.2' stroke='currentColor' class='h-4 w-4 text-black'>
      <path stroke-linecap='round' stroke-linejoin='round' d='M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z' />
    </svg>
  `,l.appendChild(c);const m=document.createElement("span");m.className="font-body text-xs",m.textContent=new Date(e.updated).toLocaleDateString([],{weekday:"short",year:"numeric",month:"short",day:"2-digit"}),l.appendChild(m);const d=document.createElement("span");d.className="font-body text-xs",d.textContent=new Date(e.updated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),l.appendChild(d),a.appendChild(l),r.appendChild(a);const i=document.createElement("h3");i.className="font-extrabold text-sm text-left",i.textContent=e.title,r.appendChild(i);const f=document.createElement("p");f.className="font-body text-xs",f.textContent=e.body,r.appendChild(f);const p=document.createElement("div");p.className="flex flex-row gap-4 items-center";const g=document.createElement("div");g.className="flex flex-row text-xs text-black underline gap-2",Array.isArray(e.tags)&&e.tags.forEach(x=>{const T=document.createElement("span");T.textContent=`#${x}`,g.appendChild(T)}),p.appendChild(g),r.appendChild(p),n.appendChild(r),t.appendChild(n);const b=document.createElement("div");b.className="flex flex-row w-[calc(100vw-2rem)] rounded-2xl border-8 border-black max-w-[42.5rem] x-8 py-2";const h=document.createElement("div");h.className="flex flex-row w-full justify-center gap-8";const N=L({label:"Edit",size:"xsmall",href:`${W}edit?id=${e.id}`});h.appendChild(N);const j=L({label:"View",size:"xsmall",href:`${W}post?id=${e.id}`});h.appendChild(j);const k=w({label:"Delete",size:"xsmall",onClick:()=>{I({title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone.",icon:"warning",confirmationLabel:"Delete",cancellationLabel:"Cancel"}).then(async x=>{if(x)try{await Pe(e.id),t.remove()}catch{alert("Failed to delete the post. Please try again.")}})}});return h.appendChild(k),b.appendChild(h),t.appendChild(b),t}const F="/so-me/";function qe({posts:e,currentPage:t,onChangeFeed:n,followingNames:o}){const r=document.createElement("div");r.innerHTML="",r.className="flex flex-col gap-4 justify-center align-center items-center";const a=document.createElement("div");if(a.className="flex flex-row justify-between gap-4 items-center w-full",a.appendChild(w({label:"Newest",size:"medium",fill:t==="newest",onClick:()=>{n("newest")}})),a.appendChild(w({label:"Following",size:"medium",fill:t==="following",onClick:()=>{n("following")}})),a.appendChild(w({label:"Create",size:"medium",fill:!1,onClick:()=>{window.location.href=F+"create"}})),r.appendChild(a),e.length===0&&t==="newest"){I({title:"You have no posts yet.",message:"Create your first post now!",icon:"warning",confirmationLabel:"Create post",cancellationLabel:"Later"}).then(d=>{d&&(window.location.href=F+"create")});const s=document.createElement("div");s.className="flex flex-col justify-center items-center w-full min-w-[20rem]",s.textContent="You have not created any posts yet.";const l=document.createElement("img"),c=new URL("/so-me/assets/bird-looking-BcGHC1fz.gif",import.meta.url).href;l.src=c,l.alt="No posts",l.className="w-auto h-48 mb-4",s.appendChild(l);const m=L({label:"Create Post",href:F+"create",size:"large",fill:!1});return r.appendChild(s),r.appendChild(m),r}if(e.length===0&&t==="following"){I({title:"No post from followed users.",message:"Go explore and follow some users!",icon:"warning",confirmationLabel:"Explore",cancellationLabel:"Later"}).then(c=>{c&&(window.location.href=F+"explore")});const s=document.createElement("img"),l=new URL("/so-me/assets/mac-looking-BAD6zzoX.gif",import.meta.url).href;return s.src=l,s.alt="No posts",s.className="w-auto h-48 mb-4",r.appendChild(s),r}return t==="newest"&&e.forEach(s=>{const l=Ue(s);r.appendChild(l)}),t==="following"&&e.length>0&&e.forEach(s=>{const l=s.author?.name||"",c=l!==""&&o?.has(l),m=M(s,c);r.appendChild(m)}),r}async function He({name:e,page:t=1,limit:n=10}){try{return await _({name:e,page:t,limit:n})}catch(o){o instanceof Error&&u({title:"Error fetching your posts.",message:o.message,icon:"error"})}}async function _e({page:e=1,limit:t=10}){try{return await q({page:e,limit:t})}catch(n){n instanceof Error&&u({title:"Error fetching followed posts for feed.",message:n.message,icon:"error"})}}async function Ze(e){try{const t=await H(e);if(!t)throw new Error("Could not fetch your profile.");return t.data}catch(t){t instanceof Error&&u({title:"Error fetching your profile.",message:t.message,icon:"error"})}}async function Oe(){if(!A()){u({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href="/login"},3e3);return}const t=localStorage.getItem("userName");if(!t){u({title:"User name not found",message:"Please log in again.",icon:"warning"}),setTimeout(()=>{window.location.href="/login"},3e3);return}const n=t;let o="newest";const r=document.createElement("div");r.className="flex flex-col items-center justify-center gap-8 mb-[10rem]";const a=document.createElement("div");a.className="flex flex-col items-center justify-center w-full",r.appendChild(a);const s=document.createElement("div");s.className="flex flex-col items-center justify-center w-full",r.appendChild(s);const l=await Ze(n);if(l){const d=De(l);a.appendChild(d)}async function c(d){if(d==="newest")return{posts:(await He({name:n,page:1,limit:10}))?.data||[],followingNames:new Set};{const[i,f]=await Promise.all([_e({page:1,limit:10}),Z(n)]);return{posts:i?.data||[],followingNames:f}}}async function m(d){C(),o=d;try{const{posts:i,followingNames:f}=await c(d),p=qe({posts:i,currentPage:o,onChangeFeed:g=>{g!==o&&m(g)},followingNames:f});s.replaceChildren(p)}catch(i){i instanceof Error&&u({title:"Error rendering profile page.",message:i.message,icon:"error"})}finally{E()}}return await m(o),r}function oe({id:e,name:t,label:n,placeholder:o,value:r,required:a,minLength:s,maxLength:l,title:c}){const m=document.createElement("div");m.className="flex flex-col w-full justify-start gap-2";const d=document.createElement("label");d.htmlFor=e,d.textContent=n,d.className="font-heading text-md font-bold";const i=document.createElement("textarea");return i.id=e,i.name=t,i.placeholder=o,i.value=r??"",i.required=a,i.minLength=s,i.maxLength=l,i.title=c,i.className="flex flex-row p-2 bg-white rounded-lg outline-[0.1875rem] outline-black justify-start items-center font-body text-sm",m.appendChild(d),m.appendChild(i),m}const We="/so-me/";async function Ve(e,t){e.preventDefault();const n=e.target,o=new FormData(n),r=o.get("title"),a=o.get("body"),s=o.get("tags"),l=o.get("image"),c=o.get("image-alt");try{const m=await Ne(t,{title:r,body:a,tags:s.split(/[,\s]+/).map(d=>d.trim().toLowerCase()).filter(Boolean),media:{url:l,alt:c}});m&&m.data&&(u({title:"Post created!",message:"Your post has been created successfully.",icon:"success"}),setTimeout(()=>{window.location.href=We+`post?id=${m.data.id}`},2e3))}catch(m){m instanceof Error&&u({title:"Error creating post.",message:m.message,icon:"error"})}}function Ye(e){const t=document.createElement("div");t.className="flex flex-col w-[90vw] bg-white px-8 py-6 rounded-3xl border-16 border-black gap-8 lg:max-w-[42.5rem]";const n=document.createElement("h1");n.innerText="Edit post",n.className="text-4xl font-extrabold self-center";const o=document.createElement("p");o.innerHTML="Edit your post below. When done, click Publish changes.",o.className="text-md font-body self-center";const r=document.createElement("form");r.id="post-edit-form",r.className="flex flex-col gap-4 w-full items-center",r.addEventListener("submit",i=>Ve(i,e.id));const a=y({id:"post-title",name:"title",label:"Post Title*",type:"text",pattern:"^.{3,60}$",value:e.title,placeholder:"Title. Max 60 characters",required:!0,title:"Title must be between 3 and 60 characters",maxLength:60,minLength:1});a.classList.add("w-full");const s=oe({id:"post-body",name:"body",label:"Post Body*",placeholder:"Write your post content here.",value:e.body,required:!0,title:"Post body must be between 3 and 280 characters",maxLength:280,minLength:3});s.classList.add("w-full");const l=y({id:"post-tags",name:"tags",label:"Tags",type:"text",pattern:"^([a-zA-Z0-9]{3,}(?:[,\\s]+[a-zA-Z0-9]{3,})*)*$",placeholder:"Enter tags separated by commas or spaces. No special characters. (Optional)",value:e.tags.join(", "),required:!1,title:"Tags must be comma separated and minimum 3 characters long"});l.classList.add("w-full"),e.media===null&&(e.media={url:"",alt:""});const c=y({id:"img-link",name:"image",label:"Image Link",type:"url",placeholder:"Enter an image link (optional)",value:e.media.url,required:!1,title:"Link must be a valid image URL",pattern:"https?://.*.(?:png|jpg|jpeg|gif|svg)"});c.classList.add("w-full");const m=y({id:"img-alt",name:"image-alt",label:"Image Alt Text",type:"text",pattern:"^.{3,150}$",placeholder:"Enter image alt text (optional)",value:e.media.alt,required:!1,title:"Alt text must be minimum 3 characters long"});m.classList.add("w-full");const d=w({label:"Publish changes",size:"medium"});return d.classList.add("mt-4"),r.appendChild(a),r.appendChild(s),r.appendChild(l),r.appendChild(c),r.appendChild(m),r.appendChild(d),t.appendChild(n),t.appendChild(o),t.appendChild(r),t}async function Xe(){const e=window.location.search,n=new URLSearchParams(e).get("id");try{if(!n)throw new Error("Post ID is missing.");const o=parseInt(n,10);return await ee(o)}catch(o){console.error("Error fetching post for post page:",o),o instanceof Error&&u({title:"Error fetching post",message:o.message,icon:"error"})}}async function Ge(){const e=document.createElement("div");e.className="flex flex-col items-center justify-center w-full",C();try{const t=await Xe();if(!t)throw new Error("Post not found.");e.appendChild(Ye(t.data))}catch(t){t instanceof Error&&u({title:"Error rendering post in edit form",message:t.message,icon:"error"})}finally{E()}return e}function Ke(e){if(!e){const i=document.createElement("div");i.textContent="Post not found.";const f=document.createElement("img"),p=new URL("/so-me/assets/mac-looking-BAD6zzoX.gif",import.meta.url).href;return f.src=p,f.alt="No posts",f.className="w-auto h-48 mb-4",i.appendChild(f),i}const t=document.createElement("article");if(t.className="flex flex-col rounded-2xl border-8 lg:border-16 border-black w-[calc(100vw-2rem)] max-w-[42.5rem]",e.data.media&&e.data.media.url){const i=document.createElement("div");i.className="flex flex-row max-h-[20rem]";const f=document.createElement("img");f.src=e.data.media.url,f.alt=e.data.media.alt||e.data.title,f.className="w-full h-auto object-cover",i.appendChild(f),t.appendChild(i)}const n=document.createElement("div");n.className="flex flex-col w-full gap-2 p-2 justify-center",t.appendChild(n);const o=document.createElement("div");o.className="flex flex-row w-full justify-between",n.appendChild(o);const r=document.createElement("span");r.className="font-body text-xs",r.textContent=e.data.author?.name||"Unknown Profile",o.appendChild(r);const a=document.createElement("div");a.className="flex flex-row gap-2 items-center";const s=document.createElement("span");s.innerHTML=`
    <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2.2' stroke='currentColor' class='h-4 w-4 text-black'>
      <path stroke-linecap='round' stroke-linejoin='round' d='M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z' />
    </svg>
  `,a.appendChild(s);const l=document.createElement("span");l.className="font-body text-xs",l.textContent=new Date(e.data.updated).toLocaleDateString([],{weekday:"short",year:"numeric",month:"short",day:"2-digit"}),a.appendChild(l);const c=document.createElement("span");c.className="font-body text-xs",c.textContent=new Date(e.data.updated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),a.appendChild(c),o.appendChild(a);const m=document.createElement("h3");m.className="font-heading font-extrabold text-2xl lg:text-4xl",m.textContent=e.data.title,n.appendChild(m);const d=document.createElement("p");if(d.className="font-body text-sm",d.textContent=e.data.body,console.log("Post body:",e.data.body),n.appendChild(d),Array.isArray(e.data.tags)&&e.data.tags.length>0){const i=document.createElement("div");i.className="flex flex-row gap-4 items-center";const f=document.createElement("div");f.className="flex flex-row text-sm text-black underline gap-2",e.data.tags.forEach(p=>{const g=document.createElement("span");g.textContent=`#${p}`,f.appendChild(g)}),i.appendChild(f),n.appendChild(i)}return t}async function Je(){const e=window.location.search,n=new URLSearchParams(e).get("id");try{if(!n)throw new Error("Post ID is missing.");const o=parseInt(n,10);return await ee(o)}catch(o){console.error("Error fetching post for post page:",o),o instanceof Error&&u({title:"Error fetching post",message:o.message,icon:"error"})}}async function Qe(){const e=document.createElement("div");e.className="flex flex-col items-center justify-center w-full",C();try{const t=await Je();if(!t)throw new Error("Post not found.");return e.appendChild(Ke(t)),e}catch(t){t instanceof Error&&u({title:"Error rendering post",message:t.message,icon:"error"})}finally{E()}return e}const et="/so-me/";async function tt({page:e=1,limit:t=10}){try{return await q({page:e,limit:t})}catch(n){n instanceof Error&&u({title:"Error fetching followed posts for feed.",message:n.message,icon:"error"})}}async function nt(){if(!A()){u({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href=et+"login"},3e3);return}const t=document.createElement("div");t.className="flex flex-col items-center justify-center gap-8 mb-[10rem]",C();try{const[n,o]=await Promise.all([tt({page:1,limit:10}),Z(localStorage.getItem("userName")||"")]);if(n&&n.data){const r=te({posts:n.data,currentPage:"following",followingNames:o||new Set});t.appendChild(r)}}catch(n){n instanceof Error&&u({title:"Error rendering home page.",message:n.message,icon:"error"})}return E(),t}const ot="/so-me/";async function rt(e){e.preventDefault();const t=e.target,n=new FormData(t),o=n.get("title"),r=n.get("body"),a=n.get("tags"),s=n.get("image"),l=n.get("image-alt");try{const c=await ve({title:o,body:r,tags:a.split(/[,\s]+/).map(m=>m.trim().toLowerCase()).filter(Boolean),media:{url:s,alt:l}});c&&c.data&&(u({title:"Post created!",message:"Your post has been created successfully.",icon:"success"}),setTimeout(()=>{window.location.href=ot+`post?id=${c.data.id}`},2e3))}catch(c){c instanceof Error&&u({title:"Error creating post.",message:c.message,icon:"error"})}}function at(){const e=document.createElement("div");e.className="flex flex-col w-[90vw] bg-white px-8 py-6 rounded-3xl border-16 border-black gap-4 lg:max-w-[42.5rem]";const t=document.createElement("h1");t.innerText="Create a post",t.className="text-4xl font-extrabold self-center";const n=document.createElement("p");n.innerHTML="Fill in the required fields * and any extra fields if you want to. When done, click Publish. You can always edit your post later.",n.className="text-md font-body self-center";const o=document.createElement("form");o.id="post-creator-form",o.className="flex flex-col gap-4 w-full items-center",o.addEventListener("submit",rt);const r=y({id:"post-title",name:"title",label:"Post Title*",type:"text",pattern:"^.{3,60}$",placeholder:"Title. Max 60 characters",required:!0,title:"Title must be between 3 and 60 characters",maxLength:60,minLength:1});r.classList.add("w-full");const a=oe({id:"post-body",label:"Post Body*",name:"body",placeholder:"Write your post content here.",required:!0,title:"Post body must be between 3 and 280 characters",minLength:3,maxLength:280});a.classList.add("w-full");const s=y({id:"post-tags",name:"tags",label:"Tags",type:"text",pattern:"^([a-zA-Z0-9]{3,}(?:[,\\s]+[a-zA-Z0-9]{3,})*)*$",placeholder:"Enter tags separated by commas or spaces. No special characters. (Optional)",required:!1,title:"Min 3 chars. Tags must be separated by commas or spaces. No special characters."});s.classList.add("w-full");const l=y({id:"img-link",name:"image",label:"Image Link",type:"url",placeholder:"Enter an image link (optional)",required:!1,title:"Link must be a valid image URL",pattern:"https?://.*.(?:png|jpg|jpeg|gif|svg)"});l.classList.add("w-full");const c=y({id:"img-alt",name:"image-alt",label:"Image Alt Text",type:"text",pattern:"^.{3,150}$",placeholder:"Enter image alt text. (Optional)",required:!1,title:"Alt text must be 150 characters or less"});c.classList.add("w-full");const m=w({label:"Publish",size:"medium"});return m.classList.add("mt-4"),o.appendChild(r),o.appendChild(a),o.appendChild(s),o.appendChild(l),o.appendChild(c),o.appendChild(m),e.appendChild(t),e.appendChild(n),e.appendChild(o),e}function st(){const e=document.createElement("div");return e.className="flex flex-col items-center justify-center w-full",e.appendChild(at()),e}const V="/so-me/";function lt(e){const{posts:t,profileName:n,initialPage:o=1,limit:r=10}=e,a=document.createElement("section");if(a.innerHTML="",a.className="flex flex-col w-full gap-4 justify-center items-center max-w-[calc(100%-2rem)] lg:max-w-[42.5rem]",t.length===0){I({title:"No post here.",message:"This user has no posts yet!",icon:"warning",confirmationLabel:"Explore other profiles",cancellationLabel:"Close"}).then(f=>{f&&(window.location.href=V+"explore")});const d=document.createElement("img"),i=new URL("/so-me/assets/mac-looking-BAD6zzoX.gif",import.meta.url).href;return d.src=i,d.alt="No posts",d.className="w-auto h-48 mb-4",a.appendChild(d),a}const s=document.createElement("div");s.className="flex flex-col w-full gap-4",a.appendChild(s);function l(d){d.forEach(i=>{const f=M(i);f.addEventListener("click",()=>{window.location.href=V+`post?id=${i.id}`}),s.appendChild(f)})}l(t);let c=o,m=!1;if(t.length===r){const d=w({label:"Load more",size:"medium",fill:!1,onClick:async()=>{if(!m){m=!0,d.disabled=!0,d.textContent="Loading...";try{const i=c+1,f=await _({name:n,page:i,limit:r});f&&f.data&&f.data.length>0?(l(f.data),c=i,f.data.length<r?d.remove():(d.textContent="Load more",d.disabled=!1)):d.remove()}catch{d.textContent="Load more",d.disabled=!1}finally{m=!1}}}});d.classList.add("mt-2","w-full"),a.appendChild(d)}return a}const re="/so-me/";function it(){const e=window.location.search,n=new URLSearchParams(e).get("name");if(!n)throw u({title:"Profile name is missing in URL",message:"Please provide a profile name in the URL as a query parameter.",icon:"warning"}),setTimeout(()=>{window.location.href=re+"explore"},3e3),new Error("Profile name is missing in URL");return n}async function ct(e){try{const t=await H(e);if(!t)throw new Error("Could not fetch your profile.");return t.data}catch(t){t instanceof Error&&u({title:"Error fetching your profile.",message:t.message,icon:"error"})}}async function dt({name:e,page:t=1,limit:n=10}){try{return await _({name:e,page:t,limit:n})}catch(o){o instanceof Error&&u({title:"Error fetching your posts.",message:o.message,icon:"error"})}}async function mt(){if(!A()){u({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href=re+"login"},3e3);return}const t=it(),n=document.createElement("div");n.className="flex flex-col items-center justify-center gap-12 mb-[10rem]";const o=document.createElement("div");o.className="flex flex-col items-center justify-center w-full",n.appendChild(o);const r=document.createElement("div");r.className="flex flex-col items-center justify-center w-full",n.appendChild(r);const a=await ct(t);if(a){console.log("Profile data:",a);const l=ne(a);o.appendChild(l)}C();const s=await dt({name:t});if(s){const l=lt({posts:s.data,profileName:t,initialPage:s.meta?.currentPage||1,limit:10});r.appendChild(l)}return E(),n}const ft={"/":Ae,"/followingfeed":nt,"/explore":Re,"/post":Qe,"/login":xe,"/register":Ce,"/myprofile":Oe,"/create":st,"/edit":Ge,"/profile":mt},P="/so-me/";function Y(e){const t=document.createElement("div");t.className="bg-white flex flex-col items-center gap-6 pt-10 pb-6";const n=document.createElement("div");n.className="w-full flex justify-center";const o=document.createElement("a");o.href=P,o.className="color-black font-heading text-3xl lg:text-6xl font-bold flex flex-row",o.append("So Me");const r=document.createElement("div");r.className="inline-block bg-gradient-to-br from-red-900 via-orange-500 to-yellow-200 bg-clip-text text-transparent transition-[background-position] duration-700 ease-linear bg-[length:400%_100%] bg-[position:0%_50%] hover:bg-[position:100%_50%]",r.textContent="!",o.appendChild(r);const a=window.location.pathname.replace(P,"");if(!(a==="login"||a==="register")){const i=document.createElement("button");i.type="button",i.className="absolute top-2 right-4 text-xs md:text-sm lg:text-base font-bold px-3 py-2 rounded-xl border-4 md:border-6 border-black bg-white hover:bg-black hover:text-white",i.textContent="Logout",i.addEventListener("click",()=>{try{localStorage.removeItem("userName"),localStorage.removeItem("accessToken")}catch(f){if(!(f instanceof Error))throw u({title:"An unknown error occurred during logout.",message:"Please try again.",icon:"error"}),f}window.location.href=P+"login"}),n.appendChild(i)}n.appendChild(o),t.appendChild(n);const l=document.createElement("nav");l.className="max-w-[64rem] mb-6 flex w-full justify-around xl:justify-between";const c=L({label:"Feed",href:P,size:"large",fill:e==="feed"}),m=L({label:"Profile",href:P+"myprofile",size:"large",fill:e==="profile"}),d=L({label:"Explore",href:P+"explore",size:"large",fill:e==="explore"});return l.appendChild(c),l.appendChild(m),l.appendChild(d),t.appendChild(l),t}const z="/so-me/";function ut(){const e=document.getElementById("header-container"),t=document.getElementById("main-container");if(!e||!t)throw new Error("Required DOM elements not found");const n=window.location.pathname,o=n.startsWith(z)?n.slice(z.length-1)||"/":n,r=X(o);e.innerHTML="",e.appendChild(Y(r));const a=new se(ft,t,s=>{const l=X(s);e.innerHTML="",e.appendChild(Y(l))});pt(a),a.resolveRoute()}function X(e){switch(e){case"/":return"feed";case"/myprofile":return"profile";case"/explore":return"explore";default:return null}}function pt(e){document.addEventListener("click",t=>{const o=t.target.closest("a[href]");if(o&&o.href.startsWith(window.location.origin)){t.preventDefault();const r=new URL(o.href);if(!r.pathname.startsWith(z))return;const a=r.pathname+r.search;e.navigate(a)}})}document.addEventListener("DOMContentLoaded",ut);
