(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const $="/so-me/";class ae{routes;outlet;onRouteChange;constructor(t,n,o){this.routes=t,this.outlet=n,this.onRouteChange=o,window.addEventListener("popstate",()=>this.resolveRoute())}navigate(t){const n=t.startsWith($)?t:$+t.replace(/^\/+/,"");history.pushState({},"",n),this.resolveRoute()}resolveRoute(){const t=window.location.pathname,n=t.startsWith($)?t.slice($.length-1)||"/":t;this.onRouteChange?.(n);const o=this.routes[n]||this.notFoundView;try{const r=o();r instanceof Promise?r.then(s=>this.render(s)).catch(()=>this.render(this.errorView("Failed to load page."))):this.render(r)}catch{this.render(this.errorView("Unexpected error."))}}render(t){typeof t=="string"?this.outlet.innerHTML=t:t instanceof HTMLElement?(this.outlet.innerHTML="",this.outlet.appendChild(t)):this.outlet.innerHTML=""}notFoundView(){return`
      <div class="text-center py-10">
        <h1 class="text-4xl font-bold color-darkgrey mb-4 font-heading">404</h1>
        <p class="text-xl color-grey font-heading">Page not found or under development</p>
        <a href="${$}" class="mt-6 inline-block text-blue-600 hover:underline font-body">
          Return to home page
        </a>
      </div>
    `}errorView(t){return`
      <div class="text-center py-10">
        <h1 class="text-2xl font-heading text-red-600 mb-4">Error</h1>
        <p class="font-body">${t}</p>
      </div>
    `}}const se={PasswordTitle:"Password must be at least 8 characters long",EmailTitle:"Email must be a @stud.noroff.no address"};function y({id:e,name:t,label:n,type:o,placeholder:r,value:s,required:a,title:l,pattern:i,minLength:d,maxLength:m}){const c=document.createElement("div");c.className="flex flex-col w-full justify-start gap-2";const u=document.createElement("label");u.htmlFor=e,u.textContent=n,u.className="font-heading text-md font-bold";const p=document.createElement("input");return p.id=e,p.name=t,p.type=o??"",p.placeholder=r??"",p.value=s??"",p.required=a??!1,p.pattern=i??"",p.minLength=d??0,p.maxLength=m??524288,p.title=l?se[l]??l:"",p.className="flex flex-row p-2 bg-white rounded-lg outline-[0.1875rem] outline-black justify-start items-center font-body text-sm",c.appendChild(u),c.appendChild(p),c}const le={xsmall:"text-xs rounded-md md:text-sm p-1 border-none md:border-none lg:border-none",small:"text-sm md:text-md p-2",medium:"text-md md:text-lg p-3",large:"text-lg md:text-xl p-4"},ie="inline-block font-extrabold rounded-2xl border-6 md:border-8 border-black";function V(e="medium",t=!1){return`${ie} ${t?"bg-black text-white hover:bg-white hover:text-black":"bg-white text-black hover:bg-black hover:text-white"} ${le[e]}`}function h({label:e,size:t="medium",id:n,fill:o=!1,onClick:r}){const s=document.createElement("button");return s.className=V(t,o),n&&(s.id=n),s.textContent=e,r&&s.addEventListener("click",r),s}function L({label:e,size:t="medium",id:n,fill:o=!1,href:r}){const s=document.createElement("a");return s.className=V(t,o),n&&(s.id=n),s.textContent=e,s.href=r,s}const ce="https://v2.api.noroff.dev";async function B(e,t={}){const{body:n,...o}=t,r={"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`,"X-Noroff-API-Key":"2b5f7ac6-af0f-4649-a046-1152e518bdb0"},s={method:n?"POST":"GET",...o,headers:{...r,...o.headers}};n&&(s.body=JSON.stringify(n));try{const a=await fetch(ce+e,s);if(!a.ok){const l=await a.json();throw new Error(l.errors?.[0]?.message||"An API error occurred")}return a.status===204?null:await a.json()}catch(a){throw console.error("API Client Error:",a),a}}const v=e=>B(e),D=(e,t)=>B(e,{body:t}),z=(e,t)=>B(e,{method:"PUT",body:t}),de=e=>B(e,{method:"DELETE"}),W={error:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.2" stroke="currentColor" class="h-[9.25rem] w-[9.25rem]"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" /> </svg>',warning:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.2" stroke="currentColor" class="h-[9.25rem] w-[9.25rem]"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" /> </svg>',success:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.2" stroke="currentColor" class="h-[9.25rem] w-[9.25rem]"> <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /> </svg>'};function f({title:e,message:t,icon:n}){const o=document.createElement("div");o.className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 border-8 lg:border-16 border-black rounded-2xl z-[1000] flex flex-col items-center justify-center w-[95vw] max-w-[35rem] md:min-w-[21rem] bg-white px-2 lg:px-6 pt-6 pb-2 gap-4";const r=document.createElement("div");r.className="flex flex-row items-center w-full max-h-[9.375rem]";const s=document.createElement("div");s.className="flex flex-col w-[calc(100%-9.25rem)] text-black gap-2 p-4";const a=document.createElement("h2");a.className="font-heading text-3xl lg:text-4xl font-extrabold",a.textContent=e;const l=document.createElement("p");l.className="font-body text-lg",l.textContent=t;const i=document.createElement("div");i.className="flex justify-center h-[9.25rem]";const d=document.createElement("svg");d.innerHTML=W[n];const m=document.createElement("div");m.className="flex flex-row width-full justify-center gap-2 p-2 md:gap-0";const c=h({label:"Close",size:"medium",onClick:()=>o.remove()});return o.appendChild(r),r.appendChild(s),s.appendChild(a),s.appendChild(l),r.appendChild(i),i.appendChild(d),o.appendChild(m),m.appendChild(c),document.body.appendChild(o),o.classList.add("show"),o}function I({title:e,message:t,icon:n,confirmationLabel:o="Confirm",cancellationLabel:r="Cancel"}){return new Promise(s=>{const a=document.createElement("div");a.className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 outline-16 outline-black rounded-lg z-[1000] flex flex-col items-center justify-center w-[60vw] md:min-w-[21rem] bg-white p-8 gap-6";const l=document.createElement("div");l.className="flex flex-row items-center w-full max-h-[9.375rem]";const i=document.createElement("div");i.className="flex flex-col w-[calc(100%-9.25rem)] text-black gap-0.5 p-4";const d=document.createElement("h3");d.className="font-heading text-4xl font-extrabold",d.textContent=e;const m=document.createElement("p");m.className="font-body text-lg",m.textContent=t;const c=document.createElement("div");c.className="flex justify-center h-[9.25rem]";const u=document.createElement("svg");u.innerHTML=W[n];const p=document.createElement("div");p.className="flex flex-row width-full justify-center gap-8 p-6";const w=h({label:r,size:"small",onClick:()=>{a.remove(),s(!1)}}),b=h({label:o,size:"small",fill:!0,onClick:()=>{a.remove(),s(!0)}});a.appendChild(l),l.appendChild(i),i.appendChild(d),i.appendChild(m),l.appendChild(c),c.appendChild(u),a.appendChild(p),p.appendChild(w),p.appendChild(b),document.body.appendChild(a),a.classList.add("show")})}async function me(e){if(!pe(e))throw new Error("Validation failed");const t=await D("/auth/register",e);if(!t)throw new Error("Error registering user: No response data received.");return t}async function fe(e){if(!ue(e))throw new Error("Validation failed");try{const t=await D("/auth/login",e);if(!t)throw new Error("Error signing in: No response data received.");return localStorage.setItem("accessToken",t.data.accessToken),localStorage.setItem("userName",t.data.name),t}catch(t){throw console.error(t),t}}function ue(e){if(!e)return f({title:"No data provided.",message:"Please check all fields, and try again.",icon:"error"}),!1;if(!e.email||!e.password)return f({title:"All fields are required.",message:"Please check all fields, and try again.",icon:"error"}),!1;const t=/^[a-zA-Z0-9._%+\-]+@stud\.noroff\.no$/,n=/^[a-zA-Z0-9._%+\-]{8,}$/;return t.test(e.email)?n.test(e.password)?!0:(f({title:"Invalid password.",message:"Password must be at least 8 characters long and can only contain letters, numbers, and special characters.",icon:"error"}),!1):(f({title:"Invalid email format.",message:"Email must be a valid email address ending with @stud.noroff.no",icon:"error"}),!1)}function pe(e){if(!e)return f({title:"No data provided.",message:"Please check all fields, and try again.",icon:"error"}),!1;if(!e.name||!e.email||!e.password)return f({title:"All fields are required.",message:"Please check all fields, and try again.",icon:"error"}),!1;const t=/^[a-zA-ZÀ-ÿ_]{3,}$/,n=/^[a-zA-Z0-9._%+\-]+@stud\.noroff\.no$/,o=/^[a-zA-ZÀ-ÿ0-9#?!@$%^&*\-]{8,}$/;return t.test(e.name)?n.test(e.email)?o.test(e.password)?!0:(f({title:"Invalid password.",message:"Password must be at least 8 characters long and can only contain letters, numbers, and special characters.",icon:"error"}),!1):(f({title:"Invalid email format.",message:"Email must be a valid email address ending with @stud.noroff.no",icon:"error"}),!1):(f({title:"Invalid name format.",message:"Name must be at least 3 characters long and can only contain letters, spaces, and hyphens.",icon:"error"}),!1)}function A(){return!!localStorage.getItem("accessToken")}const Y="/so-me/";async function ge(e){e.preventDefault();const t=e.target,n=new FormData(t),o=n.get("email"),r=n.get("password");try{const s=await fe({email:o,password:r});s&&s.data&&s.data.accessToken&&(window.location.href=Y)}catch(s){const a=s?.message+". Please check your email and password, and try again."||"Please check your email and password, and try again.";f({title:"Login failed.",message:a,icon:"error"})}}function he(){const e=document.createElement("div");e.className="flex flex-col w-[90vw] bg-white p-4 py-5 lg:px-8 lg:py-6 rounded-3xl border-8 lg:border-16 border-black lg:max-w-[42.5rem] gap-8";const t=document.createElement("h1");t.innerText="Login",t.className="text-4xl lg:text-6xl font-extrabold self-center";const n=document.createElement("p");n.innerHTML=`Do you have an account? Register <a href="${Y}register" class="underline">here</a>.`,n.className="text-lg font-body self-center";const o=document.createElement("form");o.id="login-form",o.className="flex flex-col gap-8 w-full items-center",o.addEventListener("submit",ge);const r=y({id:"email",name:"email",label:"Email",type:"email",placeholder:"Enter your email",pattern:"^[a-zA-Z0-9._%+\\-]+@stud\\.noroff\\.no$",required:!0,title:"EmailTitle"});r.classList.add("w-full");const s=y({id:"password",name:"password",label:"Password",type:"password",pattern:"^.{8,}$",placeholder:"Enter your password",required:!0,title:"PasswordTitle"});s.classList.add("w-full");const a=h({label:"Login",size:"medium"});return o.appendChild(r),o.appendChild(s),o.appendChild(a),e.appendChild(t),e.appendChild(n),e.appendChild(o),e}function we(){const e=document.createElement("div");return e.className="flex flex-col items-center justify-center w-full",e.appendChild(he()),e}const X="/so-me/";async function xe(e){e.preventDefault();const t=e.target,n=new FormData(t),r=n.get("name").trim().replace(/\s+/g,"_"),s=n.get("email"),a=n.get("password");try{const l=await me({name:r,email:s,password:a});l&&l.data&&(f({title:"Registration successful!",message:"You can now log in with your new account.",icon:"success"}),setTimeout(()=>{window.location.href=X+"login"},2e3))}catch(l){const i=l?.message||"An unknown error occurred.";f({title:"Registration Error",message:i,icon:"error"})}}function ye(){const e=document.createElement("div");e.className="flex flex-col w-[90vw] bg-white px-4 py-5 lg:px-8 lg:py-6 rounded-3xl border-8 lg:border-16 border-black gap-8 lg:max-w-[42.5rem]";const t=document.createElement("h1");t.innerText="Register account",t.className="text-4xl lg:text-6xl font-extrabold self-center";const n=document.createElement("p");n.innerHTML=`Already have an account? Login <a href="${X}login" class="underline">here</a>.`,n.className="text-lg font-body self-center";const o=document.createElement("form");o.id="register-form",o.className="flex flex-col gap-8 w-full items-center",o.addEventListener("submit",xe);const r=y({id:"name",name:"name",label:"Name",type:"text",placeholder:"Enter your name",pattern:"^[a-zA-ZÀ-ÿs-]{3,}+$",required:!0,title:"Enter your full name. Letters, spaces, and hyphens only."});r.classList.add("w-full");const s=y({id:"email",name:"email",label:"Email",type:"email",placeholder:"Enter your email",pattern:"^[a-zA-Z0-9._%+\\-]+@stud\\.noroff\\.no$",required:!0,title:"EmailTitle"});s.classList.add("w-full");const a=y({id:"password",name:"password",label:"Password",type:"password",placeholder:"Enter your password",pattern:"^.{8,}$",required:!0,title:"PasswordTitle"});a.classList.add("w-full");const l=h({label:"Register",size:"medium"});return o.appendChild(r),o.appendChild(s),o.appendChild(a),o.appendChild(l),e.appendChild(t),e.appendChild(n),e.appendChild(o),e}function be(){const e=document.createElement("div");return e.className="flex flex-col items-center justify-center w-full",e.appendChild(ye()),e}async function G({page:e=1,limit:t=10}){try{const n=await v(`/social/posts?page=${e}&limit=${t}&_author=true`);if(!n)throw new Error("Could not get posts.");return n}catch(n){throw console.error("Error fetching posts:",n),n}}async function K(e){try{const t=await v(`/social/posts/${e}?_author=true`);if(!t)throw new Error("Could not get post.");return t}catch(t){throw console.error("Error fetching post:",t),t}}async function J({page:e=1,limit:t=10}){try{const n=await v(`/social/posts/following?page=${e}&limit=${t}&_author=true`);if(!n)throw new Error("Error fetching posts from followed users.");return n}catch(n){throw console.error("Error fetching posts from followed users:",n),n}}async function Ce(e){try{const t=await v(`/social/posts/search?q=${e}&_author=true`);if(!t)throw new Error("Error fetching search results.");return t}catch(t){throw console.error("Error fetching search results:",t),t}}async function Ee(e){if(!Pe(e))throw new Error("Validation failed");try{const t=await D("/social/posts",e);if(!t)throw new Error("Error creating post: No response data received.");return t}catch(t){throw console.error("Error creating post:",t),t}}async function ve(e,t){try{const n=await z(`/social/posts/${e}`,t);if(!n)throw new Error("Error updating post: No response data received.");return n}catch(n){throw console.error("Error updating post:",n),n}}async function Ne(e){try{await de(`/social/posts/${e}`),f({title:"Post deleted",message:"The post has been successfully deleted.",icon:"success"})}catch(t){throw t instanceof Error&&f({title:"Error deleting post.",message:t.message,icon:"error"}),t}}function Pe(e){if(!e)return f({title:"No data provided.",message:"Please check all fields, and try again.",icon:"error"}),!1;if(!e.title||!e.body)return f({title:"Missing required fields.",message:"Title and body are required.",icon:"error"}),!1;const t=/^.{3,60}$/,n=/^.{3,}$/,o=/^[a-zA-ZÀ-ÿ0-9]{3,}$/,r=/^.*\.(gif|jpe?g|png|webp)($|\?.*$|#.*$|\/.*$)$/,s=/^.{3,150}$/;if(!t.test(e.title))return f({title:"Invalid title format.",message:"Min 3 chars. Letters, numbers and special characters #?!@$%^&*- are allowed.",icon:"warning"}),!1;if(!n.test(e.body))return f({title:"Invalid body format.",message:"Min 3 chars. Letters, numbers and special characters #?!@$%^&*- are allowed.",icon:"warning"}),!1;if(e.tags){for(const a of e.tags)if(!o.test(a))return f({title:"Invalid tag format.",message:"Each tag must be at least 3 characters long and can only contain letters and numbers.",icon:"warning"}),!1}if(e.media){if(!r.test(e.media.url))return f({title:"Invalid image URL format.",message:"Image URL must be a valid image file (gif, jpeg, png, webp).",icon:"warning"}),!1;if(!s.test(e.media.alt))return f({title:"Invalid image alt text format.",message:"Alt text must be 150 characters or less.",icon:"warning"}),!1}return!0}async function U(e){try{const t=await v(`/social/profiles/${e}`);if(!t)throw new Error("Could not fetch profile by name.");return t}catch(t){throw console.error("Error fetching profile by name:",t),t}}async function Q(e){try{const t=await v(`/social/profiles/${e.name}/posts?page=${e.page||1}&limit=${e.limit||10}&_author=true`);if(!t)throw new Error("Could not fetch posts by profile.");return t}catch(t){throw console.error("Error fetching posts by profile:",t),t}}async function Le(e){console.log(`Calling followProfile for: ${e}`);try{const t=await z(`/social/profiles/${e}/follow`);if(!t)throw new Error("Could not follow profile.");return t}catch(t){throw console.error("Error following profile:",t),t}}async function ke(e){try{const t=await z(`/social/profiles/${e}/unfollow`);if(!t)throw new Error("Could not unfollow profile.");return t}catch(t){throw console.error("Error fetching posts by profile:",t),t}}async function q(e){try{const t=await v(`/social/profiles/${e}?_following=true`);if(!t||!t.data)throw new Error("Could not fetch following names.");const n=t.data.following?.map(o=>o.name)||[];return new Set(n)}catch(t){throw console.error("Error fetching following names:",t),t}}const Te="/so-me/";function M(e,t){if(!e)return console.error("No post data provided to renderPostCard."),document.createElement("div");const n=document.createElement("article");n.className="post-card flex flex-col w-[calc(100%-2rem)] max-w-[42.5rem] justify-center items-center lg:flex-row w-full lg:max-h-[10rem] rounded-2xl border-8 border-black overflow-hidden";const o=document.createElement("div");if(o.className="flex lg:h-40 lg:w-[calc(20%-1rem)] shrink-0 overflow-hidden",e.media){const g=document.createElement("img");g.src=e.media.url,g.alt=e.media.alt||e.title,g.className="lg:h-full lg:w-full object-cover hover:cursor-pointer",o.appendChild(g)}n.appendChild(o);const r=document.createElement("div");r.className="flex flex-col w-full gap-2 px-2 py-1 justify-center";const s=document.createElement("div");s.className="flex flex-row w-full justify-between";const a=document.createElement("div");a.className="flex flex-row gap-2 items-center";const l=document.createElement("span");if(l.className="font-body text-xs hover:underline hover:cursor-pointer",l.textContent=e.author?.name||"Unknown Profile",l.addEventListener("click",g=>{g.stopPropagation(),window.location.href=Te+`profile?name=${e.author?.name}`}),a.appendChild(l),t!==void 0){let g=t;const N=h({label:g?"Unfollow":"Follow",size:"xsmall",onClick:async j=>{j.stopPropagation();const k=e.author?.name;if(!k){console.error("Author name is undefined. Cannot follow/unfollow.");return}const x=j.currentTarget;x.disabled=!0;const T=x.textContent;x.textContent=g?"Unfollowing...":"Following...";try{g?await ke(k):await Le(k),g=!g,x.textContent=g?"Unfollow":"Follow"}catch(re){console.error("Follow toggle failed:",re),x.textContent=T||(g?"Unfollow":"Follow")}finally{x.disabled=!1}window.location.reload()}});a.appendChild(N)}s.appendChild(a);const i=document.createElement("div");i.className="flex flex-row gap-2 items-center";const d=document.createElement("span");d.innerHTML=`
    <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2.2' stroke='currentColor' class='h-4 w-4 text-black'>
      <path stroke-linecap='round' stroke-linejoin='round' d='M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z' />
    </svg>
  `,i.appendChild(d);const m=document.createElement("span");m.className="font-body text-xs",m.textContent=new Date(e.updated).toLocaleDateString([],{weekday:"short",year:"numeric",month:"short",day:"2-digit"}),i.appendChild(m);const c=document.createElement("span");c.className="font-body text-xs",c.textContent=new Date(e.updated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),i.appendChild(c),s.appendChild(i),r.appendChild(s);const u=document.createElement("h3");u.className="font-heading font-extrabold text-sm text-left hover:cursor-pointer",u.textContent=e.title,r.appendChild(u);const p=document.createElement("p");p.className="font-body text-xs hover:cursor-pointer",p.textContent=e.body,r.appendChild(p);const w=document.createElement("div");w.className="flex flex-row gap-4 items-center";const b=document.createElement("div");return b.className="flex flex-row text-sm text-black underline gap-2",Array.isArray(e.tags)&&e.tags.forEach(g=>{const N=document.createElement("span");N.textContent=`#${g}`,b.appendChild(N)}),w.appendChild(b),r.appendChild(w),n.appendChild(r),n}const S="/so-me/";function ee({posts:e,currentPage:t,followingNames:n}){const o=document.createElement("section");o.innerHTML="",o.className="flex flex-col w-full gap-4 justify-center items-center max-w-[calc(100%-2rem)] lg:max-w-[42.5rem]";const r=document.createElement("div");if(r.className="flex flex-row justify-between items-center w-full",r.appendChild(h({label:"Newest",size:"medium",fill:t==="newest",onClick:()=>{window.location.href=S}})),r.appendChild(h({label:"Following",size:"medium",fill:t==="following",onClick:()=>{window.location.href=S+"followingfeed"}})),r.appendChild(h({label:"Create",size:"medium",fill:!1,onClick:()=>{window.location.href=S+"create"}})),o.appendChild(r),e.length===0&&t==="following"){I({title:"No post from followed users.",message:"Go explore and follow some users!",icon:"warning",confirmationLabel:"Explore",cancellationLabel:"Later"}).then(i=>{i&&(window.location.href=S+"explore")});const a=document.createElement("img"),l=new URL("/so-me/assets/mac-looking-BAD6zzoX.gif",import.meta.url).href;return a.src=l,a.alt="No posts",a.className="w-auto h-48 mb-4",o.appendChild(a),o}const s=n||new Set;return e.forEach(a=>{const l=a.author?.name||"",i=l!==""&&s.has(l),d=M(a,i);d.addEventListener("click",()=>{window.location.href=S+`post?id=${a.id}`}),o.appendChild(d)}),o}function C(e){const t=document.createElement("div");return t.className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center justify-center bg-white rounded-3xl bg-opacity-75 z-50",t.id="loader-container",t.innerHTML='<div id="loader" class="loader"></div>',document.body.appendChild(t),t}function E(){const e=document.getElementById("loader");e?(e.classList.remove("loader"),e.parentElement?.remove()):console.warn("No spinner found to hide.")}const $e="/so-me/";async function Se({page:e=1,limit:t=10}){try{return await G({page:e,limit:t})}catch(n){n instanceof Error&&f({title:"Error fetching posts for feed.",message:n.message,icon:"error"})}}async function Ie(){if(!A()){f({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href=$e+"login"},3e3);return}const t=document.createElement("div");t.className="flex flex-col items-center justify-center gap-8 mb-[10rem]",C();try{const[n,o]=await Promise.all([Se({page:1,limit:10}),q(localStorage.getItem("userName")||"")]);if(n&&n.data){const r=ee({posts:n.data,currentPage:"newest",followingNames:o||new Set});t.appendChild(r)}}catch(n){n instanceof Error&&f({title:"Error rendering home page.",message:n.message,icon:"error"})}return E(),t}const Ae="/so-me/";function te(e){if(!e)return console.error("No profile data provided to renderProfileCard."),document.createElement("div");const t=document.createElement("article");if(t.className="profile-card flex flex-col w-[calc(100%-2rem)] sm:max-w-[42.5rem] justify-center items-center sm:flex-row lg:max-h-[8rem] rounded-2xl border-8 border-black overflow-hidden hover:cursor-pointer",t.addEventListener("click",()=>{window.location.href=Ae+`profile?name=${e.name}`}),e.avatar){const m=document.createElement("div");m.className="flex justify-center sm:max-w-[calc(20%-1rem)] shrink-0 lg:h-40 lg:w-[calc(20%-1rem)]",t.appendChild(m);const c=document.createElement("img");c.src=e.avatar.url,c.alt=e.avatar.alt,c.className="lg:h-full lg:w-full object-cover",m.appendChild(c)}const n=document.createElement("div");n.className="flex flex-col w-full gap-2 px-2 py-1 justify-center";const o=document.createElement("div");o.className="flex flex-col lg:flex-row w-full justify-between";const r=document.createElement("div");r.className="flex flex-row gap-2 items-center";const s=document.createElement("span");s.className="font-heading text-md font-extrabold",s.textContent=e.name,r.appendChild(s),o.appendChild(r);const a=document.createElement("div");a.className="flex flex-row gap-2 items-center";const l=document.createElement("span");l.className="font-body text-xs",l.textContent=`Followers: ${e._count.followers}`,a.appendChild(l);const i=document.createElement("span");i.className="font-body text-xs",i.textContent=`Following: ${e._count.following}`,a.appendChild(i),o.appendChild(a),n.appendChild(o);const d=document.createElement("p");return d.className="font-body text-xs",d.textContent=e.bio,n.appendChild(d),t.appendChild(n),t}async function je(e,t){e.preventDefault();const n=e.target,r=new FormData(n).get("search");t(r)}function Fe(e){const t=document.createElement("div");t.className="flex flex-col w-[90vw] bg-white p-4 py-5 lg:px-8 lg:py-6 rounded-3xl border-8 lg:border-16 border-black lg:max-w-[42.5rem] gap-8";const n=document.createElement("h1");n.innerText="Search",n.className="text-md lg:text-6xl font-extrabold self-center";const o=document.createElement("p");o.innerHTML="Search for keywords in posts.",o.className="text-xs font-body self-center";const r=document.createElement("form");r.id="search-form",r.className="flex flex-col gap-8 w-full items-center",r.addEventListener("submit",l=>je(l,e));const s=y({id:"search",name:"search",label:"Search",type:"text",placeholder:"Enter one search keyword",pattern:"\\S{1,30}",required:!0,title:"SearchTitle"}),a=h({label:"Search",size:"medium"});return r.appendChild(s),r.appendChild(a),t.appendChild(n),t.appendChild(o),t.appendChild(r),t}async function Be({page:e=1,limit:t=30}={}){const n=await G({page:e,limit:t});if(!n||!n.data)return[];const o=new Set,r=[];for(const s of n.data){const a=s.author?.name;a&&!o.has(a)&&(o.add(a),r.push(a))}return r}async function Me(e){const t=await Promise.allSettled(e.map(o=>U(o))),n=[];for(const o of t)o.status==="fulfilled"&&o.value?.data&&n.push(o.value.data);return n}async function Re(){if(!A()){f({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href="/login"},3e3);return}const t=document.createElement("div");t.className="flex flex-col items-center justify-center mb-[10rem]";const n=document.createElement("div");n.className="flex flex-col items-center justify-center w-full mb-8";const o=document.createElement("div");o.className="flex flex-col items-center justify-center w-full gap-6";function r(a){a.trim()&&(C(),Ce(a).then(l=>{if(o.innerHTML="",!l||!l.data||l.data.length===0){f({title:"No posts found",message:"No posts matched your search query.",icon:"warning"});return}for(const i of l.data)o.appendChild(M(i))}).catch(l=>{console.error("Error searching posts:",l),l instanceof Error&&f({title:"Error searching posts",message:l.message,icon:"error"})}).finally(()=>E()))}const s=Fe(r);n.appendChild(s),t.appendChild(n),t.appendChild(o),C();try{const a=await Be({page:1,limit:30});if(a.length===0)throw new Error("No authors found from posts.");const l=await Me(a);if(l.length===0)throw new Error("No profiles found for the authors.");for(const i of l)o.appendChild(te(i))}catch(a){a instanceof Error&&f({title:"Error rendering explore page",message:a.message,icon:"error"})}finally{E()}return t}function De(e){if(!e)return console.error("No profile data provided to renderMyProfileCard."),document.createElement("div");const t=document.createElement("article");if(t.className="profile-card flex flex-col w-[calc(100%-2rem)] sm:max-w-[42.5rem] justify-center items-center sm:flex-row lg:max-h-[8rem] rounded-2xl border-8 border-black overflow-hidden",e.avatar){const m=document.createElement("div");m.className="flex justify-center sm:max-w-[calc(20%-1rem)] shrink-0 lg:h-40 lg:w-[calc(20%-1rem)]",t.appendChild(m);const c=document.createElement("img");c.src=e.avatar.url,c.alt=e.avatar.alt,c.className="lg:h-full lg:w-full object-cover",m.appendChild(c)}const n=document.createElement("div");n.className="flex flex-col w-full gap-2 px-2 py-1 justify-center";const o=document.createElement("div");o.className="flex flex-col lg:flex-row w-full justify-between";const r=document.createElement("div");r.className="flex flex-row gap-2 items-center";const s=document.createElement("span");s.className="font-heading text-md font-extrabold",s.textContent=e.name,r.appendChild(s),o.appendChild(r);const a=document.createElement("div");a.className="flex flex-row gap-2 items-center";const l=document.createElement("span");l.className="font-body text-xs",l.textContent=`Followers: ${e._count.followers}`,a.appendChild(l);const i=document.createElement("span");i.className="font-body text-xs",i.textContent=`Following: ${e._count.following}`,a.appendChild(i),o.appendChild(a),n.appendChild(o);const d=document.createElement("p");return d.className="font-body text-xs",d.textContent=e.bio,n.appendChild(d),t.appendChild(n),t}const H="/so-me/";function ze(e){if(!e)return document.createElement("div");const t=document.createElement("article");t.className="post-card flex flex-col w-[calc(100vw-2rem)] max-w-[42.5rem] gap-2";const n=document.createElement("div");n.className="flex flex-col sm:items-center sm:flex-row rounded-2xl overflow-hidden border-8 border-black";const o=document.createElement("div");if(o.className="flex justify-center sm:max-w-[calc(20%-1rem)] shrink-0",e.media){const x=document.createElement("img");x.src=e.media.url,x.alt=e.media.alt||"",x.className="flex h-full object-cover",o.appendChild(x)}n.appendChild(o);const r=document.createElement("div");r.className="flex flex-col w-full gap-2 px-2 py-1 justify-center";const s=document.createElement("div");s.className="flex flex-row w-full justify-between";const a=document.createElement("span");a.className="font-body text-xs",a.textContent=e.author?.name||"Unknown Profile",s.appendChild(a);const l=document.createElement("div");l.className="flex flex-row gap-2 items-center";const i=document.createElement("span");i.innerHTML=`
    <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2.2' stroke='currentColor' class='h-4 w-4 text-black'>
      <path stroke-linecap='round' stroke-linejoin='round' d='M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z' />
    </svg>
  `,l.appendChild(i);const d=document.createElement("span");d.className="font-body text-xs",d.textContent=new Date(e.updated).toLocaleDateString([],{weekday:"short",year:"numeric",month:"short",day:"2-digit"}),l.appendChild(d);const m=document.createElement("span");m.className="font-body text-xs",m.textContent=new Date(e.updated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),l.appendChild(m),s.appendChild(l),r.appendChild(s);const c=document.createElement("h3");c.className="font-extrabold text-sm text-left",c.textContent=e.title,r.appendChild(c);const u=document.createElement("p");u.className="font-body text-xs",u.textContent=e.body,r.appendChild(u);const p=document.createElement("div");p.className="flex flex-row gap-4 items-center";const w=document.createElement("div");w.className="flex flex-row text-xs text-black underline gap-2",Array.isArray(e.tags)&&e.tags.forEach(x=>{const T=document.createElement("span");T.textContent=`#${x}`,w.appendChild(T)}),p.appendChild(w),r.appendChild(p),n.appendChild(r),t.appendChild(n);const b=document.createElement("div");b.className="flex flex-row w-[calc(100vw-2rem)] rounded-2xl border-8 border-black max-w-[42.5rem] x-8 py-2";const g=document.createElement("div");g.className="flex flex-row w-full justify-center gap-8";const N=L({label:"Edit",size:"xsmall",href:`${H}edit?id=${e.id}`});g.appendChild(N);const j=L({label:"View",size:"xsmall",href:`${H}post?id=${e.id}`});g.appendChild(j);const k=h({label:"Delete",size:"xsmall",onClick:()=>{I({title:"Delete Post",message:"Are you sure you want to delete this post? This action cannot be undone.",icon:"warning",confirmationLabel:"Delete",cancellationLabel:"Cancel"}).then(async x=>{if(x)try{await Ne(e.id),t.remove()}catch{alert("Failed to delete the post. Please try again.")}})}});return g.appendChild(k),b.appendChild(g),t.appendChild(b),t}const F="/so-me/";function Ue({posts:e,currentPage:t,onChangeFeed:n,followingNames:o}){const r=document.createElement("div");r.innerHTML="",r.className="flex flex-col gap-4 justify-center align-center items-center";const s=document.createElement("div");if(s.className="flex flex-row justify-between gap-4 items-center w-full",s.appendChild(h({label:"Newest",size:"medium",fill:t==="newest",onClick:()=>{n("newest")}})),s.appendChild(h({label:"Following",size:"medium",fill:t==="following",onClick:()=>{n("following")}})),s.appendChild(h({label:"Create",size:"medium",fill:!1,onClick:()=>{window.location.href=F+"create"}})),r.appendChild(s),e.length===0&&t==="newest"){I({title:"You have no posts yet.",message:"Create your first post now!",icon:"warning",confirmationLabel:"Create post",cancellationLabel:"Later"}).then(m=>{m&&(window.location.href=F+"create")});const a=document.createElement("div");a.className="flex flex-col justify-center items-center w-full min-w-[20rem]",a.textContent="You have not created any posts yet.";const l=document.createElement("img"),i=new URL("/so-me/assets/bird-looking-BcGHC1fz.gif",import.meta.url).href;l.src=i,l.alt="No posts",l.className="w-auto h-48 mb-4",a.appendChild(l);const d=L({label:"Create Post",href:F+"create",size:"large",fill:!1});return r.appendChild(a),r.appendChild(d),r}if(e.length===0&&t==="following"){I({title:"No post from followed users.",message:"Go explore and follow some users!",icon:"warning",confirmationLabel:"Explore",cancellationLabel:"Later"}).then(i=>{i&&(window.location.href=F+"explore")});const a=document.createElement("img"),l=new URL("/so-me/assets/mac-looking-BAD6zzoX.gif",import.meta.url).href;return a.src=l,a.alt="No posts",a.className="w-auto h-48 mb-4",r.appendChild(a),r}return t==="newest"&&e.forEach(a=>{const l=ze(a);r.appendChild(l)}),t==="following"&&e.length>0&&e.forEach(a=>{const l=a.author?.name||"",i=l!==""&&o?.has(l),d=M(a,i);r.appendChild(d)}),r}async function qe({name:e,page:t=1,limit:n=10}){try{return await Q({name:e,page:t,limit:n})}catch(o){o instanceof Error&&f({title:"Error fetching your posts.",message:o.message,icon:"error"})}}async function He({page:e=1,limit:t=10}){try{return await J({page:e,limit:t})}catch(n){n instanceof Error&&f({title:"Error fetching followed posts for feed.",message:n.message,icon:"error"})}}async function _e(e){try{const t=await U(e);if(!t)throw new Error("Could not fetch your profile.");return t.data}catch(t){t instanceof Error&&f({title:"Error fetching your profile.",message:t.message,icon:"error"})}}async function Ze(){if(!A()){f({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href="/login"},3e3);return}const t=localStorage.getItem("userName");if(!t){f({title:"User name not found",message:"Please log in again.",icon:"warning"}),setTimeout(()=>{window.location.href="/login"},3e3);return}const n=t;let o="newest";const r=document.createElement("div");r.className="flex flex-col items-center justify-center gap-8 mb-[10rem]";const s=document.createElement("div");s.className="flex flex-col items-center justify-center w-full",r.appendChild(s);const a=document.createElement("div");a.className="flex flex-col items-center justify-center w-full",r.appendChild(a);const l=await _e(n);if(l){const m=De(l);s.appendChild(m)}async function i(m){if(m==="newest")return{posts:(await qe({name:n,page:1,limit:10}))?.data||[],followingNames:new Set};{const[c,u]=await Promise.all([He({page:1,limit:10}),q(n)]);return{posts:c?.data||[],followingNames:u}}}async function d(m){C(),o=m;try{const{posts:c,followingNames:u}=await i(m),p=Ue({posts:c,currentPage:o,onChangeFeed:w=>{w!==o&&d(w)},followingNames:u});a.replaceChildren(p)}catch(c){c instanceof Error&&f({title:"Error rendering profile page.",message:c.message,icon:"error"})}finally{E()}}return await d(o),r}function ne({id:e,name:t,label:n,placeholder:o,value:r,required:s,minLength:a,maxLength:l,title:i}){const d=document.createElement("div");d.className="flex flex-col w-full justify-start gap-2";const m=document.createElement("label");m.htmlFor=e,m.textContent=n,m.className="font-heading text-md font-bold";const c=document.createElement("textarea");return c.id=e,c.name=t,c.placeholder=o,c.value=r??"",c.required=s,c.minLength=a,c.maxLength=l,c.title=i,c.className="flex flex-row p-2 bg-white rounded-lg outline-[0.1875rem] outline-black justify-start items-center font-body text-sm",d.appendChild(m),d.appendChild(c),d}const Oe="/so-me/";async function Ve(e,t){e.preventDefault();const n=e.target,o=new FormData(n),r=o.get("title"),s=o.get("body"),a=o.get("tags"),l=o.get("image"),i=o.get("image-alt");try{const d=await ve(t,{title:r,body:s,tags:a.split(/[,\s]+/).map(m=>m.trim().toLowerCase()).filter(Boolean),media:{url:l,alt:i}});d&&d.data&&(f({title:"Post created!",message:"Your post has been created successfully.",icon:"success"}),setTimeout(()=>{window.location.href=Oe+`post?id=${d.data.id}`},2e3))}catch(d){d instanceof Error&&f({title:"Error creating post.",message:d.message,icon:"error"})}}function We(e){const t=document.createElement("div");t.className="flex flex-col w-[90vw] bg-white px-8 py-6 rounded-3xl border-16 border-black gap-8 lg:max-w-[42.5rem]";const n=document.createElement("h1");n.innerText="Edit post",n.className="text-4xl font-extrabold self-center";const o=document.createElement("p");o.innerHTML="Edit your post below. When done, click Publish changes.",o.className="text-md font-body self-center";const r=document.createElement("form");r.id="post-edit-form",r.className="flex flex-col gap-4 w-full items-center",r.addEventListener("submit",c=>Ve(c,e.id));const s=y({id:"post-title",name:"title",label:"Post Title*",type:"text",pattern:"^.{3,60}$",value:e.title,placeholder:"Title. Max 60 characters",required:!0,title:"Title must be between 3 and 60 characters",maxLength:60,minLength:1});s.classList.add("w-full");const a=ne({id:"post-body",name:"body",label:"Post Body*",placeholder:"Write your post content here.",value:e.body,required:!0,title:"Post body must be between 3 and 280 characters",maxLength:280,minLength:3});a.classList.add("w-full");const l=y({id:"post-tags",name:"tags",label:"Tags",type:"text",pattern:"^([a-zA-Z0-9]{3,}(?:[,\\s]+[a-zA-Z0-9]{3,})*)*$",placeholder:"Enter tags separated by commas or spaces. No special characters. (Optional)",value:e.tags.join(", "),required:!1,title:"Tags must be comma separated and minimum 3 characters long"});l.classList.add("w-full"),e.media===null&&(e.media={url:"",alt:""});const i=y({id:"img-link",name:"image",label:"Image Link",type:"url",placeholder:"Enter an image link (optional)",value:e.media.url,required:!1,title:"Link must be a valid image URL",pattern:"https?://.*.(?:png|jpg|jpeg|gif|svg)"});i.classList.add("w-full");const d=y({id:"img-alt",name:"image-alt",label:"Image Alt Text",type:"text",pattern:"^.{3,150}$",placeholder:"Enter image alt text (optional)",value:e.media.alt,required:!1,title:"Alt text must be minimum 3 characters long"});d.classList.add("w-full");const m=h({label:"Publish changes",size:"medium"});return m.classList.add("mt-4"),r.appendChild(s),r.appendChild(a),r.appendChild(l),r.appendChild(i),r.appendChild(d),r.appendChild(m),t.appendChild(n),t.appendChild(o),t.appendChild(r),t}async function Ye(){const e=window.location.search,n=new URLSearchParams(e).get("id");try{if(!n)throw new Error("Post ID is missing.");const o=parseInt(n,10);return await K(o)}catch(o){console.error("Error fetching post for post page:",o),o instanceof Error&&f({title:"Error fetching post",message:o.message,icon:"error"})}}async function Xe(){const e=document.createElement("div");e.className="flex flex-col items-center justify-center w-full",C();try{const t=await Ye();if(!t)throw new Error("Post not found.");e.appendChild(We(t.data))}catch(t){t instanceof Error&&f({title:"Error rendering post in edit form",message:t.message,icon:"error"})}finally{E()}return e}function Ge(e){if(!e){const c=document.createElement("div");c.textContent="Post not found.";const u=document.createElement("img"),p=new URL("/so-me/assets/mac-looking-BAD6zzoX.gif",import.meta.url).href;return u.src=p,u.alt="No posts",u.className="w-auto h-48 mb-4",c.appendChild(u),c}const t=document.createElement("article");if(t.className="flex flex-col rounded-2xl border-8 lg:border-16 border-black w-[calc(100vw-2rem)] max-w-[42.5rem]",e.data.media&&e.data.media.url){const c=document.createElement("div");c.className="flex flex-row max-h-[20rem]";const u=document.createElement("img");u.src=e.data.media.url,u.alt=e.data.media.alt||e.data.title,u.className="w-full h-auto object-cover",c.appendChild(u),t.appendChild(c)}const n=document.createElement("div");n.className="flex flex-col w-full gap-2 p-2 justify-center",t.appendChild(n);const o=document.createElement("div");o.className="flex flex-row w-full justify-between",n.appendChild(o);const r=document.createElement("span");r.className="font-body text-xs",r.textContent=e.data.author?.name||"Unknown Profile",o.appendChild(r);const s=document.createElement("div");s.className="flex flex-row gap-2 items-center";const a=document.createElement("span");a.innerHTML=`
    <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='2.2' stroke='currentColor' class='h-4 w-4 text-black'>
      <path stroke-linecap='round' stroke-linejoin='round' d='M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z' />
    </svg>
  `,s.appendChild(a);const l=document.createElement("span");l.className="font-body text-xs",l.textContent=new Date(e.data.updated).toLocaleDateString([],{weekday:"short",year:"numeric",month:"short",day:"2-digit"}),s.appendChild(l);const i=document.createElement("span");i.className="font-body text-xs",i.textContent=new Date(e.data.updated).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),s.appendChild(i),o.appendChild(s);const d=document.createElement("h3");d.className="font-heading font-extrabold text-2xl lg:text-4xl",d.textContent=e.data.title,n.appendChild(d);const m=document.createElement("p");if(m.className="font-body text-sm",m.textContent=e.data.body,console.log("Post body:",e.data.body),n.appendChild(m),Array.isArray(e.data.tags)&&e.data.tags.length>0){const c=document.createElement("div");c.className="flex flex-row gap-4 items-center";const u=document.createElement("div");u.className="flex flex-row text-sm text-black underline gap-2",e.data.tags.forEach(p=>{const w=document.createElement("span");w.textContent=`#${p}`,u.appendChild(w)}),c.appendChild(u),n.appendChild(c)}return t}async function Ke(){const e=window.location.search,n=new URLSearchParams(e).get("id");try{if(!n)throw new Error("Post ID is missing.");const o=parseInt(n,10);return await K(o)}catch(o){console.error("Error fetching post for post page:",o),o instanceof Error&&f({title:"Error fetching post",message:o.message,icon:"error"})}}async function Je(){const e=document.createElement("div");e.className="flex flex-col items-center justify-center w-full",C();try{const t=await Ke();if(!t)throw new Error("Post not found.");return e.appendChild(Ge(t)),e}catch(t){t instanceof Error&&f({title:"Error rendering post",message:t.message,icon:"error"})}finally{E()}return e}const Qe="/so-me/";async function et({page:e=1,limit:t=10}){try{return await J({page:e,limit:t})}catch(n){n instanceof Error&&f({title:"Error fetching followed posts for feed.",message:n.message,icon:"error"})}}async function tt(){if(!A()){f({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href=Qe+"login"},3e3);return}const t=document.createElement("div");t.className="flex flex-col items-center justify-center gap-8 mb-[10rem]",C();try{const[n,o]=await Promise.all([et({page:1,limit:10}),q(localStorage.getItem("userName")||"")]);if(n&&n.data){const r=ee({posts:n.data,currentPage:"following",followingNames:o||new Set});t.appendChild(r)}}catch(n){n instanceof Error&&f({title:"Error rendering home page.",message:n.message,icon:"error"})}return E(),t}const nt="/so-me/";async function ot(e){e.preventDefault();const t=e.target,n=new FormData(t),o=n.get("title"),r=n.get("body"),s=n.get("tags"),a=n.get("image"),l=n.get("image-alt");try{const i=await Ee({title:o,body:r,tags:s.split(/[,\s]+/).map(d=>d.trim().toLowerCase()).filter(Boolean),media:{url:a,alt:l}});i&&i.data&&(f({title:"Post created!",message:"Your post has been created successfully.",icon:"success"}),setTimeout(()=>{window.location.href=nt+`post?id=${i.data.id}`},2e3))}catch(i){i instanceof Error&&f({title:"Error creating post.",message:i.message,icon:"error"})}}function rt(){const e=document.createElement("div");e.className="flex flex-col w-[90vw] bg-white px-8 py-6 rounded-3xl border-16 border-black gap-4 lg:max-w-[42.5rem]";const t=document.createElement("h1");t.innerText="Create a post",t.className="text-4xl font-extrabold self-center";const n=document.createElement("p");n.innerHTML="Fill in the required fields * and any extra fields if you want to. When done, click Publish. You can always edit your post later.",n.className="text-md font-body self-center";const o=document.createElement("form");o.id="post-creator-form",o.className="flex flex-col gap-4 w-full items-center",o.addEventListener("submit",ot);const r=y({id:"post-title",name:"title",label:"Post Title*",type:"text",pattern:"^.{3,60}$",placeholder:"Title. Max 60 characters",required:!0,title:"Title must be between 3 and 60 characters",maxLength:60,minLength:1});r.classList.add("w-full");const s=ne({id:"post-body",label:"Post Body*",name:"body",placeholder:"Write your post content here.",required:!0,title:"Post body must be between 3 and 280 characters",minLength:3,maxLength:280});s.classList.add("w-full");const a=y({id:"post-tags",name:"tags",label:"Tags",type:"text",pattern:"^([a-zA-Z0-9]{3,}(?:[,\\s]+[a-zA-Z0-9]{3,})*)*$",placeholder:"Enter tags separated by commas or spaces. No special characters. (Optional)",required:!1,title:"Min 3 chars. Tags must be separated by commas or spaces. No special characters."});a.classList.add("w-full");const l=y({id:"img-link",name:"image",label:"Image Link",type:"url",placeholder:"Enter an image link (optional)",required:!1,title:"Link must be a valid image URL",pattern:"https?://.*.(?:png|jpg|jpeg|gif|svg)"});l.classList.add("w-full");const i=y({id:"img-alt",name:"image-alt",label:"Image Alt Text",type:"text",pattern:"^.{3,150}$",placeholder:"Enter image alt text. (Optional)",required:!1,title:"Alt text must be 150 characters or less"});i.classList.add("w-full");const d=h({label:"Publish",size:"medium"});return d.classList.add("mt-4"),o.appendChild(r),o.appendChild(s),o.appendChild(a),o.appendChild(l),o.appendChild(i),o.appendChild(d),e.appendChild(t),e.appendChild(n),e.appendChild(o),e}function at(){const e=document.createElement("div");return e.className="flex flex-col items-center justify-center w-full",e.appendChild(rt()),e}const _="/so-me/";function st(e){const t=document.createElement("section");if(t.innerHTML="",t.className="flex flex-col w-full gap-4 justify-center items-center max-w-[calc(100%-2rem)] lg:max-w-[42.5rem]",e.length===0){I({title:"No post here.",message:"This user has no posts yet!",icon:"warning",confirmationLabel:"Explore other profiles",cancellationLabel:"Close"}).then(r=>{r&&(window.location.href=_+"explore")});const n=document.createElement("img"),o=new URL("/so-me/assets/mac-looking-BAD6zzoX.gif",import.meta.url).href;return n.src=o,n.alt="No posts",n.className="w-auto h-48 mb-4",t.appendChild(n),t}return e.forEach(n=>{const o=M(n);o.addEventListener("click",()=>{window.location.href=_+`post?id=${n.id}`}),t.appendChild(o)}),t}const oe="/so-me/";function lt(){const e=window.location.search,n=new URLSearchParams(e).get("name");if(!n)throw f({title:"Profile name is missing in URL",message:"Please provide a profile name in the URL as a query parameter.",icon:"warning"}),setTimeout(()=>{window.location.href=oe+"explore"},3e3),new Error("Profile name is missing in URL");return n}async function it(e){try{const t=await U(e);if(!t)throw new Error("Could not fetch your profile.");return t.data}catch(t){t instanceof Error&&f({title:"Error fetching your profile.",message:t.message,icon:"error"})}}async function ct({name:e,page:t=1,limit:n=10}){try{return await Q({name:e,page:t,limit:n})}catch(o){o instanceof Error&&f({title:"Error fetching your posts.",message:o.message,icon:"error"})}}async function dt(){if(!A()){f({title:"You are not logged in",message:"Please log in to see your feed.",icon:"warning"}),setTimeout(()=>{window.location.href=oe+"login"},3e3);return}const t=lt(),n=document.createElement("div");n.className="flex flex-col items-center justify-center gap-12 mb-[10rem]";const o=document.createElement("div");o.className="flex flex-col items-center justify-center w-full",n.appendChild(o);const r=document.createElement("div");r.className="flex flex-col items-center justify-center w-full",n.appendChild(r);const s=await it(t);if(s){console.log("Profile data:",s);const l=te(s);o.appendChild(l)}C();const a=await ct({name:t});if(a){console.log("Posts response:",a);const l=st(a.data);r.appendChild(l)}return E(),n}const mt={"/":Ie,"/followingfeed":tt,"/explore":Re,"/post":Je,"/login":we,"/register":be,"/myprofile":Ze,"/create":at,"/edit":Xe,"/profile":dt},P="/so-me/";function Z(e){const t=document.createElement("div");t.className="bg-white flex flex-col items-center gap-6 pt-10 pb-6";const n=document.createElement("div");n.className="w-full flex justify-center";const o=document.createElement("a");o.href=P,o.className="color-black font-heading text-3xl lg:text-6xl font-bold flex flex-row",o.append("So Me");const r=document.createElement("div");r.className="inline-block bg-gradient-to-br from-red-900 via-orange-500 to-yellow-200 bg-clip-text text-transparent transition-[background-position] duration-700 ease-linear bg-[length:400%_100%] bg-[position:0%_50%] hover:bg-[position:100%_50%]",r.textContent="!",o.appendChild(r);const s=window.location.pathname.replace(P,"");if(!(s==="login"||s==="register")){const c=document.createElement("button");c.type="button",c.className="absolute top-2 right-4 text-xs md:text-sm lg:text-base font-bold px-3 py-2 rounded-xl border-4 md:border-6 border-black bg-white hover:bg-black hover:text-white",c.textContent="Logout",c.addEventListener("click",()=>{try{localStorage.removeItem("userName"),localStorage.removeItem("accessToken")}catch(u){if(!(u instanceof Error))throw f({title:"An unknown error occurred during logout.",message:"Please try again.",icon:"error"}),u}window.location.href=P+"login"}),n.appendChild(c)}n.appendChild(o),t.appendChild(n);const l=document.createElement("nav");l.className="max-w-[64rem] mb-6 flex w-full justify-around xl:justify-between";const i=L({label:"Feed",href:P,size:"large",fill:e==="feed"}),d=L({label:"Profile",href:P+"myprofile",size:"large",fill:e==="profile"}),m=L({label:"Explore",href:P+"explore",size:"large",fill:e==="explore"});return l.appendChild(i),l.appendChild(d),l.appendChild(m),t.appendChild(l),t}const R="/so-me/";function ft(){const e=document.getElementById("header-container"),t=document.getElementById("main-container");if(!e||!t)throw new Error("Required DOM elements not found");const n=window.location.pathname,o=n.startsWith(R)?n.slice(R.length-1)||"/":n,r=O(o);e.innerHTML="",e.appendChild(Z(r));const s=new ae(mt,t,a=>{const l=O(a);e.innerHTML="",e.appendChild(Z(l))});ut(s),s.resolveRoute()}function O(e){switch(e){case"/":return"feed";case"/myprofile":return"profile";case"/explore":return"explore";default:return null}}function ut(e){document.addEventListener("click",t=>{const o=t.target.closest("a[href]");if(o&&o.href.startsWith(window.location.origin)){t.preventDefault();const r=new URL(o.href);if(!r.pathname.startsWith(R))return;const s=r.pathname+r.search;e.navigate(s)}})}document.addEventListener("DOMContentLoaded",ft);
